/*
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *
 *  http://aws.amazon.com/apache2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

package software.amazon.awssdk.enhanced.dynamodb.functionaltests.models;

import static java.util.Collections.singletonList;
import static java.util.Collections.singletonMap;
import static software.amazon.awssdk.enhanced.dynamodb.extensions.AutoGeneratedTimestampRecordExtension.AttributeTags.autoGeneratedTimestampAttribute;
import static software.amazon.awssdk.enhanced.dynamodb.mapper.StaticAttributeTags.primaryPartitionKey;
import static software.amazon.awssdk.enhanced.dynamodb.mapper.StaticAttributeTags.updateBehavior;

import java.time.Instant;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.Set;
import software.amazon.awssdk.enhanced.dynamodb.EnhancedType;
import software.amazon.awssdk.enhanced.dynamodb.TableSchema;
import software.amazon.awssdk.enhanced.dynamodb.extensions.annotations.DynamoDbAutoGeneratedTimestampAttribute;
import software.amazon.awssdk.enhanced.dynamodb.mapper.BeanTableSchema;
import software.amazon.awssdk.enhanced.dynamodb.mapper.ImmutableTableSchema;
import software.amazon.awssdk.enhanced.dynamodb.mapper.StaticImmutableTableSchema;
import software.amazon.awssdk.enhanced.dynamodb.mapper.StaticTableSchema;
import software.amazon.awssdk.enhanced.dynamodb.mapper.UpdateBehavior;
import software.amazon.awssdk.enhanced.dynamodb.mapper.annotations.DynamoDbBean;
import software.amazon.awssdk.enhanced.dynamodb.mapper.annotations.DynamoDbImmutable;
import software.amazon.awssdk.enhanced.dynamodb.mapper.annotations.DynamoDbPartitionKey;
import software.amazon.awssdk.enhanced.dynamodb.mapper.annotations.DynamoDbUpdateBehavior;
import software.amazon.awssdk.utils.ImmutableMap;

public final class AutogeneratedTimestampModels {

    private AutogeneratedTimestampModels() {
    }

    // Constants
    public static final String ID_1 = "1";
    public static final String ID_2 = "2";
    public static final String ID_ATTR = "id";
    public static final String TIME_ATTR = "time";

    public static final String ATTR_LEVEL1 = "attr_level1";
    public static final String ATTR_LEVEL2 = "attr_level2";
    public static final String ATTR_LEVEL3 = "attr_level3";
    public static final String ATTR_LEVEL4 = "attr_level4";
    public static final String ATTR_CHILD1 = "attr_child1";
    public static final String ATTR_CHILD2 = "attr_child2";

    public static final String CHILD1_KEY = "child1";
    public static final String CHILD2_KEY = "child2";
    public static final String LEVEL2_KEY = "level2";
    public static final String LEVEL3_KEY = "level3";
    public static final String LEVEL4_KEY = "level4";


    // Simple Bean Records
    @DynamoDbBean
    public static class SimpleBeanRecordWithList {
        private String id;
        private String attr;
        private Instant time;
        private List<SimpleBeanChild> childList;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public SimpleBeanRecordWithList setId(String id) {
            this.id = id;
            return this;
        }

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        public SimpleBeanRecordWithList setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public SimpleBeanRecordWithList setTime(Instant time) {
            this.time = time;
            return this;
        }


        public List<SimpleBeanChild> getChildList() {
            return childList == null ? null : Collections.unmodifiableList(childList);
        }

        public SimpleBeanRecordWithList setChildList(List<SimpleBeanChild> childList) {
            this.childList = childList;
            return this;
        }
    }

    @DynamoDbBean
    public static class SimpleBeanRecordWithSet {
        private String id;
        private String attr;
        private Instant time;
        private Set<SimpleBeanChild> childSet;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public SimpleBeanRecordWithSet setId(String id) {
            this.id = id;
            return this;
        }

        public String getAttr() {
            return attr;
        }

        public SimpleBeanRecordWithSet setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public SimpleBeanRecordWithSet setTime(Instant time) {
            this.time = time;
            return this;
        }

        public Set<SimpleBeanChild> getChildSet() {
            return childSet == null ? null : Collections.unmodifiableSet(childSet);
        }

        public SimpleBeanRecordWithSet setChildSet(Set<SimpleBeanChild> childSet) {
            this.childSet = childSet;
            return this;
        }
    }

    @DynamoDbBean
    public static class SimpleBeanRecordWithMap {
        private String id;
        private String attr;
        private Instant time;
        private Map<String, SimpleBeanChild> childMap;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public SimpleBeanRecordWithMap setId(String id) {
            this.id = id;
            return this;
        }

        public String getAttr() {
            return attr;
        }

        public SimpleBeanRecordWithMap setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public SimpleBeanRecordWithMap setTime(Instant time) {
            this.time = time;
            return this;
        }

        public Map<String, SimpleBeanChild> getChildMap() {
            return childMap == null ? null : Collections.unmodifiableMap(childMap);
        }

        public SimpleBeanRecordWithMap setChildMap(Map<String, SimpleBeanChild> childMap) {
            this.childMap = childMap;
            return this;
        }
    }

    // simple record used by list/set/map as the deepest nested level
    @DynamoDbBean
    public static class SimpleBeanChild {
        private String id;
        private String attr;
        private Instant time;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public SimpleBeanChild setId(String id) {
            this.id = id;
            return this;
        }

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        public SimpleBeanChild setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public SimpleBeanChild setTime(Instant time) {
            this.time = time;
            return this;
        }
    }


    // Nested Bean Records
    @DynamoDbBean
    public static class NestedBeanRecordWithList {
        private String id;
        private String attr;
        private Instant time;
        private NestedBeanLevel2RecordWithList level2;
        private List<NestedBeanLevel2RecordWithList> level2List;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public NestedBeanRecordWithList setId(String id) {
            this.id = id;
            return this;
        }

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        public NestedBeanRecordWithList setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanRecordWithList setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedBeanLevel2RecordWithList getLevel2() {
            return level2;
        }

        public NestedBeanRecordWithList setLevel2(NestedBeanLevel2RecordWithList level2) {
            this.level2 = level2;
            return this;
        }

        public List<NestedBeanLevel2RecordWithList> getLevel2List() {
            return level2List == null ? null : Collections.unmodifiableList(level2List);
        }

        public NestedBeanRecordWithList setLevel2List(List<NestedBeanLevel2RecordWithList> level2List) {
            this.level2List = level2List;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedBeanRecordWithList)) {
                return false;
            }

            NestedBeanRecordWithList that = (NestedBeanRecordWithList) o;
            return Objects.equals(id, that.id) &&
                   Objects.equals(attr, that.attr) &&
                   Objects.equals(time, that.time) &&
                   Objects.equals(level2, that.level2) &&
                   Objects.equals(level2List, that.level2List);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(id);
            result = 31 * result + Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level2);
            result = 31 * result + Objects.hashCode(level2List);
            return result;
        }
    }

    @DynamoDbBean
    public static class NestedBeanLevel2RecordWithList {
        private String attr;
        private Instant time;
        private NestedBeanLevel3RecordWithList level3;
        private List<NestedBeanLevel3RecordWithList> level3List;

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        public NestedBeanLevel2RecordWithList setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanLevel2RecordWithList setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedBeanLevel3RecordWithList getLevel3() {
            return level3;
        }

        public NestedBeanLevel2RecordWithList setLevel3(NestedBeanLevel3RecordWithList level3) {
            this.level3 = level3;
            return this;
        }

        public List<NestedBeanLevel3RecordWithList> getLevel3List() {
            return level3List;
        }

        public NestedBeanLevel2RecordWithList setLevel3List(List<NestedBeanLevel3RecordWithList> level3List) {
            this.level3List = level3List;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedBeanLevel2RecordWithList)) {
                return false;
            }

            NestedBeanLevel2RecordWithList that = (NestedBeanLevel2RecordWithList) o;
            return Objects.equals(attr, that.attr) &&
                   Objects.equals(time, that.time) &&
                   Objects.equals(level3, that.level3) &&
                   Objects.equals(level3List, that.level3List);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level3);
            result = 31 * result + Objects.hashCode(level3List);
            return result;
        }
    }

    @DynamoDbBean
    public static class NestedBeanLevel3RecordWithList {
        private String attr;
        private Instant time;
        private NestedBeanLevel4Record level4;
        private List<NestedBeanLevel4Record> level4List;

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        public NestedBeanLevel3RecordWithList setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanLevel3RecordWithList setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedBeanLevel4Record getLevel4() {
            return level4;
        }

        public NestedBeanLevel3RecordWithList setLevel4(NestedBeanLevel4Record level4) {
            this.level4 = level4;
            return this;
        }

        public List<NestedBeanLevel4Record> getLevel4List() {
            return level4List;
        }

        public NestedBeanLevel3RecordWithList setLevel4List(List<NestedBeanLevel4Record> level4List) {
            this.level4List = level4List;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedBeanLevel3RecordWithList)) {
                return false;
            }

            NestedBeanLevel3RecordWithList that = (NestedBeanLevel3RecordWithList) o;
            return Objects.equals(attr, that.attr) &&
                   Objects.equals(time, that.time) &&
                   Objects.equals(level4, that.level4) &&
                   Objects.equals(level4List, that.level4List);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level4);
            result = 31 * result + Objects.hashCode(level4List);
            return result;
        }
    }

    @DynamoDbBean
    public static class NestedBeanRecordWithSet {
        private String id;
        private String attr;
        private Instant time;
        private NestedBeanLevel2RecordWithSet level2;
        private Set<NestedBeanLevel2RecordWithSet> level2Set;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public NestedBeanRecordWithSet setId(String v) {
            id = v;
            return this;
        }

        public String getAttr() {
            return attr;
        }

        public NestedBeanRecordWithSet setAttr(String v) {
            attr = v;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanRecordWithSet setTime(Instant v) {
            time = v;
            return this;
        }

        public NestedBeanLevel2RecordWithSet getLevel2() {
            return level2;
        }

        public NestedBeanRecordWithSet setLevel2(NestedBeanLevel2RecordWithSet v) {
            level2 = v;
            return this;
        }

        public Set<NestedBeanLevel2RecordWithSet> getLevel2Set() {
            return level2Set;
        }

        public NestedBeanRecordWithSet setLevel2Set(Set<NestedBeanLevel2RecordWithSet> v) {
            level2Set = v;
            return this;
        }
    }

    @DynamoDbBean
    public static class NestedBeanLevel2RecordWithSet {
        private String attr;
        private Instant time;
        private NestedBeanLevel3RecordWithSet level3;
        private Set<NestedBeanLevel3RecordWithSet> level3Set;

        public String getAttr() {
            return attr;
        }

        public NestedBeanLevel2RecordWithSet setAttr(String v) {
            attr = v;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanLevel2RecordWithSet setTime(Instant v) {
            time = v;
            return this;
        }

        public NestedBeanLevel3RecordWithSet getLevel3() {
            return level3;
        }

        public NestedBeanLevel2RecordWithSet setLevel3(NestedBeanLevel3RecordWithSet v) {
            level3 = v;
            return this;
        }

        public Set<NestedBeanLevel3RecordWithSet> getLevel3Set() {
            return level3Set;
        }

        public NestedBeanLevel2RecordWithSet setLevel3Set(Set<NestedBeanLevel3RecordWithSet> v) {
            level3Set = v;
            return this;
        }
    }

    @DynamoDbBean
    public static class NestedBeanLevel3RecordWithSet {
        private String attr;
        private Instant time;
        private NestedBeanLevel4Record level4;
        private Set<NestedBeanLevel4Record> level4Set;

        public String getAttr() {
            return attr;
        }

        public NestedBeanLevel3RecordWithSet setAttr(String v) {
            attr = v;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanLevel3RecordWithSet setTime(Instant v) {
            time = v;
            return this;
        }

        public NestedBeanLevel4Record getLevel4() {
            return level4;
        }

        public NestedBeanLevel3RecordWithSet setLevel4(NestedBeanLevel4Record v) {
            level4 = v;
            return this;
        }

        public Set<NestedBeanLevel4Record> getLevel4Set() {
            return level4Set;
        }

        public NestedBeanLevel3RecordWithSet setLevel4Set(Set<NestedBeanLevel4Record> v) {
            level4Set = v;
            return this;
        }
    }

    @DynamoDbBean
    public static class NestedBeanRecordWithMap {
        private String id;
        private String attr;
        private Instant time;
        private NestedBeanLevel2RecordWithMap level2;
        private Map<String, NestedBeanLevel2RecordWithMap> level2Map;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public NestedBeanRecordWithMap setId(String id) {
            this.id = id;
            return this;
        }

        public String getAttr() {
            return attr;
        }

        public NestedBeanRecordWithMap setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanRecordWithMap setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedBeanLevel2RecordWithMap getLevel2() {
            return level2;
        }

        public NestedBeanRecordWithMap setLevel2(NestedBeanLevel2RecordWithMap level2) {
            this.level2 = level2;
            return this;
        }

        public Map<String, NestedBeanLevel2RecordWithMap> getLevel2Map() {
            return Collections.unmodifiableMap(level2Map);
        }

        public NestedBeanRecordWithMap setLevel2Map(Map<String, NestedBeanLevel2RecordWithMap> level2Map) {
            this.level2Map = level2Map;
            return this;
        }
    }

    @DynamoDbBean
    public static class NestedBeanLevel2RecordWithMap {
        private String attr;
        private Instant time;
        private NestedBeanLevel3RecordWithMap level3;
        private Map<String, NestedBeanLevel3RecordWithMap> level3Map;

        public String getAttr() {
            return attr;
        }

        public NestedBeanLevel2RecordWithMap setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanLevel2RecordWithMap setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedBeanLevel3RecordWithMap getLevel3() {
            return level3;
        }

        public NestedBeanLevel2RecordWithMap setLevel3(NestedBeanLevel3RecordWithMap level3) {
            this.level3 = level3;
            return this;
        }

        public Map<String, NestedBeanLevel3RecordWithMap> getLevel3Map() {
            return Collections.unmodifiableMap(level3Map);
        }

        public NestedBeanLevel2RecordWithMap setLevel3Map(Map<String, NestedBeanLevel3RecordWithMap> level3Map) {
            this.level3Map = level3Map;
            return this;
        }
    }

    @DynamoDbBean
    public static class NestedBeanLevel3RecordWithMap {
        private String attr;
        private Instant time;
        private NestedBeanLevel4Record level4;
        private Map<String, NestedBeanLevel4Record> level4Map;

        public String getAttr() {
            return attr;
        }

        public NestedBeanLevel3RecordWithMap setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanLevel3RecordWithMap setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedBeanLevel4Record getLevel4() {
            return level4;
        }

        public NestedBeanLevel3RecordWithMap setLevel4(NestedBeanLevel4Record level4) {
            this.level4 = level4;
            return this;
        }

        public Map<String, NestedBeanLevel4Record> getLevel4Map() {
            return Collections.unmodifiableMap(level4Map);
        }

        public NestedBeanLevel3RecordWithMap setLevel4Map(Map<String, NestedBeanLevel4Record> level4Map) {
            this.level4Map = level4Map;
            return this;
        }
    }

    // nested record used by list/set/map as the deepest nested level
    @DynamoDbBean
    public static class NestedBeanLevel4Record {
        private String id;
        private String attr;
        private Instant time;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public NestedBeanLevel4Record setId(String id) {
            this.id = id;
            return this;
        }

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        public NestedBeanLevel4Record setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanLevel4Record setTime(Instant time) {
            this.time = time;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedBeanLevel4Record)) {
                return false;
            }

            NestedBeanLevel4Record that = (NestedBeanLevel4Record) o;
            return Objects.equals(attr, that.attr) &&
                   Objects.equals(time, that.time);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            return result;
        }
    }


    // Simple Immutable Records
    @DynamoDbImmutable(builder = SimpleImmutableRecordWithList.Builder.class)
    public static final class SimpleImmutableRecordWithList {
        private final String id;
        private final String attr;
        private final Instant time;
        private final List<SimpleImmutableChild> childList;

        private SimpleImmutableRecordWithList(Builder b) {
            this.id = b.id;
            this.attr = b.attr;
            this.time = b.time;
            this.childList = b.childList;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }


        public List<SimpleImmutableChild> getChildList() {
            return childList == null ? null : Collections.unmodifiableList(childList);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private String attr;
            private Instant time;
            private List<SimpleImmutableChild> childList;

            public Builder id(String id) {
                this.id = id;
                return this;
            }

            public Builder attr(String attr) {
                this.attr = attr;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public Builder childList(List<SimpleImmutableChild> childList) {
                this.childList = childList;
                return this;
            }

            public SimpleImmutableRecordWithList build() {
                return new SimpleImmutableRecordWithList(this);
            }
        }
    }

    @DynamoDbImmutable(builder = SimpleImmutableRecordWithSet.Builder.class)
    public static class SimpleImmutableRecordWithSet {
        private final String id;
        private final String attr;
        private final Instant time;
        private final Set<SimpleImmutableChild> childSet;

        private SimpleImmutableRecordWithSet(Builder b) {
            this.id = b.id;
            this.attr = b.attr;
            this.time = b.time;
            this.childSet = b.childSet;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }


        public Set<SimpleImmutableChild> getChildSet() {
            return Collections.unmodifiableSet(childSet);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private String attr;
            private Instant time;
            private Set<SimpleImmutableChild> childSet;

            public Builder id(String v) {
                this.id = v;
                return this;
            }

            public Builder attr(String v) {
                this.attr = v;
                return this;
            }

            public Builder time(Instant v) {
                this.time = v;
                return this;
            }

            public Builder childSet(Set<SimpleImmutableChild> v) {
                this.childSet = v;
                return this;
            }

            public SimpleImmutableRecordWithSet build() {
                return new SimpleImmutableRecordWithSet(this);
            }
        }
    }

    @DynamoDbImmutable(builder = SimpleImmutableRecordWithMap.Builder.class)
    public static class SimpleImmutableRecordWithMap {
        private final String id;
        private final String attr;
        private final Instant time;
        private final Map<String, SimpleImmutableChild> childMap;

        private SimpleImmutableRecordWithMap(Builder b) {
            this.id = b.id;
            this.attr = b.attr;
            this.time = b.time;
            this.childMap = b.childMap;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public Map<String, SimpleImmutableChild> getChildMap() {
            return Collections.unmodifiableMap(childMap);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private String attr;
            private Instant time;
            private Map<String, SimpleImmutableChild> childMap;

            public Builder id(String id) {
                this.id = id;
                return this;
            }

            public Builder attr(String attr) {
                this.attr = attr;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public Builder childMap(Map<String, SimpleImmutableChild> childMap) {
                this.childMap = childMap;
                return this;
            }

            public SimpleImmutableRecordWithMap build() {
                return new SimpleImmutableRecordWithMap(this);
            }
        }
    }

    // simple record used by list/set/map as the deepest nested level
    @DynamoDbImmutable(builder = SimpleImmutableChild.Builder.class)
    public static final class SimpleImmutableChild {
        private final String id;
        private final String attr;
        private final Instant time;

        private SimpleImmutableChild(Builder b) {
            this.id = b.id;
            this.attr = b.attr;
            this.time = b.time;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private String attr;
            private Instant time;

            public Builder id(String id) {
                this.id = id;
                return this;
            }

            public Builder attr(String attr) {
                this.attr = attr;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public SimpleImmutableChild build() {
                return new SimpleImmutableChild(this);
            }
        }
    }


    // Nested Immutable Records
    @DynamoDbImmutable(builder = NestedImmutableRecordWithList.Builder.class)
    public static final class NestedImmutableRecordWithList {
        private final String id;
        private final String attr;
        private final Instant time;
        private final NestedImmutableLevel2RecordWithList level2;
        private final List<NestedImmutableLevel2RecordWithList> level2List;

        private NestedImmutableRecordWithList(Builder b) {
            this.id = b.id;
            this.attr = b.attr;
            this.time = b.time;
            this.level2 = b.level2;
            this.level2List = b.level2List;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedImmutableLevel2RecordWithList getLevel2() {
            return level2;
        }

        public List<NestedImmutableLevel2RecordWithList> getLevel2List() {
            return level2List == null ? null : Collections.unmodifiableList(level2List);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private String attr;
            private Instant time;
            private NestedImmutableLevel2RecordWithList level2;
            private List<NestedImmutableLevel2RecordWithList> level2List;

            public Builder id(String id) {
                this.id = id;
                return this;
            }

            public Builder attr(String attr) {
                this.attr = attr;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public Builder level2(NestedImmutableLevel2RecordWithList level2) {
                this.level2 = level2;
                return this;
            }

            public Builder level2List(List<NestedImmutableLevel2RecordWithList> level2List) {
                this.level2List = level2List;
                return this;
            }

            public NestedImmutableRecordWithList build() {
                return new NestedImmutableRecordWithList(this);
            }
        }
    }

    @DynamoDbImmutable(builder = NestedImmutableLevel2RecordWithList.Builder.class)
    public static final class NestedImmutableLevel2RecordWithList {
        private final String attr;
        private final Instant time;
        private final NestedImmutableLevel3RecordWithList level3;
        private final List<NestedImmutableLevel3RecordWithList> level3List;

        private NestedImmutableLevel2RecordWithList(Builder b) {
            this.attr = b.attr;
            this.time = b.time;
            this.level3 = b.level3;
            this.level3List = b.level3List;
        }

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedImmutableLevel3RecordWithList getLevel3() {
            return level3;
        }

        public List<NestedImmutableLevel3RecordWithList> getLevel3List() {
            return level3List;
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String attr;
            private Instant time;
            private NestedImmutableLevel3RecordWithList level3;
            private List<NestedImmutableLevel3RecordWithList> level3List;

            public Builder attr(String attr) {
                this.attr = attr;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public Builder level3(NestedImmutableLevel3RecordWithList level3) {
                this.level3 = level3;
                return this;
            }

            public Builder level3List(List<NestedImmutableLevel3RecordWithList> level3List) {
                this.level3List = level3List;
                return this;
            }

            public NestedImmutableLevel2RecordWithList build() {
                return new NestedImmutableLevel2RecordWithList(this);
            }
        }
    }

    @DynamoDbImmutable(builder = NestedImmutableLevel3RecordWithList.Builder.class)
    public static final class NestedImmutableLevel3RecordWithList {
        private final String attr;
        private final Instant time;
        private final NestedImmutableLevel4Record level4;
        private final List<NestedImmutableLevel4Record> level4List;

        private NestedImmutableLevel3RecordWithList(Builder b) {
            this.attr = b.attr;
            this.time = b.time;
            this.level4 = b.level4;
            this.level4List = b.level4List;
        }

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedImmutableLevel4Record getLevel4() {
            return level4;
        }

        public List<NestedImmutableLevel4Record> getLevel4List() {
            return level4List;
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String attr;
            private Instant time;
            private NestedImmutableLevel4Record level4;
            private List<NestedImmutableLevel4Record> level4List;

            public Builder attr(String attr) {
                this.attr = attr;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public Builder level4(NestedImmutableLevel4Record level4) {
                this.level4 = level4;
                return this;
            }

            public Builder level4List(List<NestedImmutableLevel4Record> level4List) {
                this.level4List = level4List;
                return this;
            }

            public NestedImmutableLevel3RecordWithList build() {
                return new NestedImmutableLevel3RecordWithList(this);
            }
        }
    }

    @DynamoDbImmutable(builder = NestedImmutableRecordWithSet.Builder.class)
    public static final class NestedImmutableRecordWithSet {
        private final String id;
        private final String attr;
        private final Instant time;
        private final NestedImmutableLevel2RecordWithSet level2;
        private final Set<NestedImmutableLevel2RecordWithSet> level2Set;

        private NestedImmutableRecordWithSet(Builder b) {
            id = b.id;
            attr = b.attr;
            time = b.time;
            level2 = b.level2;
            level2Set = b.level2Set;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedImmutableLevel2RecordWithSet getLevel2() {
            return level2;
        }

        public Set<NestedImmutableLevel2RecordWithSet> getLevel2Set() {
            return level2Set == null ? null : Collections.unmodifiableSet(level2Set);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private String attr;
            private Instant time;
            private NestedImmutableLevel2RecordWithSet level2;
            private Set<NestedImmutableLevel2RecordWithSet> level2Set;

            public Builder id(String v) {
                id = v;
                return this;
            }

            public Builder attr(String v) {
                attr = v;
                return this;
            }

            public Builder time(Instant v) {
                time = v;
                return this;
            }

            public Builder level2(NestedImmutableLevel2RecordWithSet v) {
                level2 = v;
                return this;
            }

            public Builder level2Set(Set<NestedImmutableLevel2RecordWithSet> v) {
                level2Set = v;
                return this;
            }

            public NestedImmutableRecordWithSet build() {
                return new NestedImmutableRecordWithSet(this);
            }
        }
    }

    @DynamoDbImmutable(builder = NestedImmutableLevel2RecordWithSet.Builder.class)
    public static class NestedImmutableLevel2RecordWithSet {
        private final String attr;
        private final Instant time;
        private final NestedImmutableLevel3RecordWithSet level3;
        private final Set<NestedImmutableLevel3RecordWithSet> level3Set;

        private NestedImmutableLevel2RecordWithSet(Builder b) {
            attr = b.attr;
            time = b.time;
            level3 = b.level3;
            level3Set = b.level3Set;
        }

        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedImmutableLevel3RecordWithSet getLevel3() {
            return level3;
        }

        public Set<NestedImmutableLevel3RecordWithSet> getLevel3Set() {
            return level3Set == null ? null : Collections.unmodifiableSet(level3Set);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String attr;
            private Instant time;
            private NestedImmutableLevel3RecordWithSet level3;
            private Set<NestedImmutableLevel3RecordWithSet> level3Set;

            public Builder attr(String v) {
                attr = v;
                return this;
            }

            public Builder time(Instant v) {
                time = v;
                return this;
            }

            public Builder level3(NestedImmutableLevel3RecordWithSet v) {
                level3 = v;
                return this;
            }

            public Builder level3Set(Set<NestedImmutableLevel3RecordWithSet> v) {
                level3Set = v;
                return this;
            }

            public NestedImmutableLevel2RecordWithSet build() {
                return new NestedImmutableLevel2RecordWithSet(this);
            }
        }
    }

    @DynamoDbImmutable(builder = NestedImmutableLevel3RecordWithSet.Builder.class)
    public static class NestedImmutableLevel3RecordWithSet {
        private final String attr;
        private final Instant time;
        private final NestedImmutableLevel4Record level4;
        private final Set<NestedImmutableLevel4Record> level4Set;

        private NestedImmutableLevel3RecordWithSet(Builder b) {
            attr = b.attr;
            time = b.time;
            level4 = b.level4;
            level4Set = b.level4Set;
        }

        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedImmutableLevel4Record getLevel4() {
            return level4;
        }

        public Set<NestedImmutableLevel4Record> getLevel4Set() {
            return level4Set == null ? null : Collections.unmodifiableSet(level4Set);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String attr;
            private Instant time;
            private NestedImmutableLevel4Record level4;
            private Set<NestedImmutableLevel4Record> level4Set;

            public Builder attr(String v) {
                attr = v;
                return this;
            }

            public Builder time(Instant v) {
                time = v;
                return this;
            }

            public Builder level4(NestedImmutableLevel4Record v) {
                level4 = v;
                return this;
            }

            public Builder level4Set(Set<NestedImmutableLevel4Record> v) {
                level4Set = v;
                return this;
            }

            public NestedImmutableLevel3RecordWithSet build() {
                return new NestedImmutableLevel3RecordWithSet(this);
            }
        }
    }

    @DynamoDbImmutable(builder = NestedImmutableRecordWithMap.Builder.class)
    public static class NestedImmutableRecordWithMap {
        private final String id;
        private final String attr;
        private final Instant time;
        private final NestedImmutableLevel2RecordWithMap level2;
        private final Map<String, NestedImmutableLevel2RecordWithMap> level2Map;

        private NestedImmutableRecordWithMap(Builder b) {
            this.id = b.id;
            this.attr = b.attr;
            this.time = b.time;
            this.level2 = b.level2;
            this.level2Map = b.level2Map;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedImmutableLevel2RecordWithMap getLevel2() {
            return level2;
        }

        public Map<String, NestedImmutableLevel2RecordWithMap> getLevel2Map() {
            return level2Map == null ? null : Collections.unmodifiableMap(level2Map);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private String attr;
            private Instant time;
            private NestedImmutableLevel2RecordWithMap level2;
            private Map<String, NestedImmutableLevel2RecordWithMap> level2Map;

            public Builder id(String id) {
                this.id = id;
                return this;
            }

            public Builder attr(String attr) {
                this.attr = attr;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public Builder level2(NestedImmutableLevel2RecordWithMap v) {
                this.level2 = v;
                return this;
            }

            public Builder level2Map(Map<String, NestedImmutableLevel2RecordWithMap> v) {
                this.level2Map = v;
                return this;
            }

            public NestedImmutableRecordWithMap build() {
                return new NestedImmutableRecordWithMap(this);
            }
        }
    }

    @DynamoDbImmutable(builder = NestedImmutableLevel2RecordWithMap.Builder.class)
    public static class NestedImmutableLevel2RecordWithMap {
        private final String attr;
        private final Instant time;
        private final NestedImmutableLevel3RecordWithMap level3;
        private final Map<String, NestedImmutableLevel3RecordWithMap> level3Map;

        private NestedImmutableLevel2RecordWithMap(Builder b) {
            this.attr = b.attr;
            this.time = b.time;
            this.level3 = b.level3;
            this.level3Map = b.level3Map;
        }

        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedImmutableLevel3RecordWithMap getLevel3() {
            return level3;
        }

        public Map<String, NestedImmutableLevel3RecordWithMap> getLevel3Map() {
            return level3Map == null ? null : Collections.unmodifiableMap(level3Map);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String attr;
            private Instant time;
            private NestedImmutableLevel3RecordWithMap level3;
            private Map<String, NestedImmutableLevel3RecordWithMap> level3Map;

            public Builder attr(String v) {
                this.attr = v;
                return this;
            }

            public Builder time(Instant v) {
                this.time = v;
                return this;
            }

            public Builder level3(NestedImmutableLevel3RecordWithMap v) {
                this.level3 = v;
                return this;
            }

            public Builder level3Map(Map<String, NestedImmutableLevel3RecordWithMap> v) {
                this.level3Map = v;
                return this;
            }

            public NestedImmutableLevel2RecordWithMap build() {
                return new NestedImmutableLevel2RecordWithMap(this);
            }
        }
    }

    @DynamoDbImmutable(builder = NestedImmutableLevel3RecordWithMap.Builder.class)
    public static class NestedImmutableLevel3RecordWithMap {
        private final String attr;
        private final Instant time;
        private final NestedImmutableLevel4Record level4;
        private final Map<String, NestedImmutableLevel4Record> level4Map;

        private NestedImmutableLevel3RecordWithMap(Builder b) {
            this.attr = b.attr;
            this.time = b.time;
            this.level4 = b.level4;
            this.level4Map = b.level4Map;
        }

        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedImmutableLevel4Record getLevel4() {
            return level4;
        }

        public Map<String, NestedImmutableLevel4Record> getLevel4Map() {
            return level4Map == null ? null : Collections.unmodifiableMap(level4Map);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String attr;
            private Instant time;
            private NestedImmutableLevel4Record level4;
            private Map<String, NestedImmutableLevel4Record> level4Map;

            public Builder attr(String v) {
                this.attr = v;
                return this;
            }

            public Builder time(Instant v) {
                this.time = v;
                return this;
            }

            public Builder level4(NestedImmutableLevel4Record v) {
                this.level4 = v;
                return this;
            }

            public Builder level4Map(Map<String, NestedImmutableLevel4Record> v) {
                this.level4Map = v;
                return this;
            }

            public NestedImmutableLevel3RecordWithMap build() {
                return new NestedImmutableLevel3RecordWithMap(this);
            }
        }
    }

    // nested record used by list/set/map as the deepest nested level
    @DynamoDbImmutable(builder = NestedImmutableLevel4Record.Builder.class)
    public static final class NestedImmutableLevel4Record {
        private final String id;
        private final String attr;
        private final Instant time;

        private NestedImmutableLevel4Record(Builder b) {
            this.id = b.id;
            this.attr = b.attr;
            this.time = b.time;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        @DynamoDbUpdateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)
        public String getAttr() {
            return attr;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private String attr;
            private Instant time;

            public Builder id(String id) {
                this.id = id;
                return this;
            }

            public Builder attr(String attr) {
                this.attr = attr;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public NestedImmutableLevel4Record build() {
                return new NestedImmutableLevel4Record(this);
            }
        }
    }


    // Simple Static Records
    public static class SimpleStaticRecordWithSet {
        private String id;
        private String attr;
        private Instant time;
        private Set<SimpleStaticChild> childSet;

        public String getId() {
            return id;
        }

        public SimpleStaticRecordWithSet setId(String id) {
            this.id = id;
            return this;
        }

        public String getAttr() {
            return attr;
        }

        public SimpleStaticRecordWithSet setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public SimpleStaticRecordWithSet setTime(Instant time) {
            this.time = time;
            return this;
        }

        public Set<SimpleStaticChild> getChildSet() {
            return Collections.unmodifiableSet(childSet);
        }

        public SimpleStaticRecordWithSet setChildSet(Set<SimpleStaticChild> childSet) {
            this.childSet = childSet;
            return this;
        }
    }

    public static class SimpleStaticRecordWithMap {
        private String id;
        private String attr;
        private Instant time;
        private Map<String, SimpleStaticChild> childMap;

        public String getId() {
            return id;
        }

        public SimpleStaticRecordWithMap setId(String id) {
            this.id = id;
            return this;
        }

        public String getAttr() {
            return attr;
        }

        public SimpleStaticRecordWithMap setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public SimpleStaticRecordWithMap setTime(Instant time) {
            this.time = time;
            return this;
        }

        public Map<String, SimpleStaticChild> getChildMap() {
            return Collections.unmodifiableMap(childMap);
        }

        public SimpleStaticRecordWithMap setChildMap(Map<String, SimpleStaticChild> childMap) {
            this.childMap = childMap;
            return this;
        }
    }

    public static class SimpleStaticRecordWithList {
        private String id;
        private String attr;
        private Instant time;
        private List<SimpleStaticChild> childList;

        public String getId() {
            return id;
        }

        public SimpleStaticRecordWithList setId(String id) {
            this.id = id;
            return this;
        }


        public String getAttr() {
            return attr;
        }

        public SimpleStaticRecordWithList setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public SimpleStaticRecordWithList setTime(Instant time) {
            this.time = time;
            return this;
        }


        public List<SimpleStaticChild> getChildList() {
            return childList == null ? null : Collections.unmodifiableList(childList);
        }

        public SimpleStaticRecordWithList setChildList(List<SimpleStaticChild> childList) {
            this.childList = childList;
            return this;
        }
    }

    // simple record used by list/set/map as the deepest nested level
    public static class SimpleStaticChild {
        private String id;
        private String attr;
        private Instant time;

        public String getId() {
            return id;
        }

        public SimpleStaticChild setId(String id) {
            this.id = id;
            return this;
        }


        public String getAttr() {
            return attr;
        }

        public SimpleStaticChild setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public SimpleStaticChild setTime(Instant time) {
            this.time = time;
            return this;
        }
    }


    // Nested Static Records
    public static class NestedStaticRecordWithList {
        private String id;
        private String attr;
        private Instant time;
        private NestedStaticLevel2RecordWithList level2;
        private List<NestedStaticLevel2RecordWithList> level2List;

        public String getId() {
            return id;
        }

        public NestedStaticRecordWithList setId(String id) {
            this.id = id;
            return this;
        }


        public String getAttr() {
            return attr;
        }

        public NestedStaticRecordWithList setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public NestedStaticRecordWithList setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedStaticLevel2RecordWithList getLevel2() {
            return level2;
        }

        public NestedStaticRecordWithList setLevel2(NestedStaticLevel2RecordWithList level2) {
            this.level2 = level2;
            return this;
        }

        public List<NestedStaticLevel2RecordWithList> getLevel2List() {
            return level2List;
        }

        public NestedStaticRecordWithList setLevel2List(List<NestedStaticLevel2RecordWithList> level2List) {
            this.level2List = level2List;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedStaticRecordWithList)) {
                return false;
            }

            NestedStaticRecordWithList that = (NestedStaticRecordWithList) o;
            return Objects.equals(id, that.id) && Objects.equals(attr, that.attr) && Objects.equals(time, that.time) && Objects.equals(level2, that.level2) && Objects.equals(level2List, that.level2List);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(id);
            result = 31 * result + Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level2);
            result = 31 * result + Objects.hashCode(level2List);
            return result;
        }
    }

    public static class NestedStaticLevel2RecordWithList {
        private String attr;
        private Instant time;
        private NestedStaticLevel3RecordWithList level3;
        private List<NestedStaticLevel3RecordWithList> level3List;


        public String getAttr() {
            return attr;
        }

        public NestedStaticLevel2RecordWithList setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public NestedStaticLevel2RecordWithList setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedStaticLevel3RecordWithList getLevel3() {
            return level3;
        }

        public NestedStaticLevel2RecordWithList setLevel3(NestedStaticLevel3RecordWithList level3) {
            this.level3 = level3;
            return this;
        }

        public List<NestedStaticLevel3RecordWithList> getLevel3List() {
            return level3List;
        }

        public NestedStaticLevel2RecordWithList setLevel3List(List<NestedStaticLevel3RecordWithList> level3List) {
            this.level3List = level3List;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedStaticLevel2RecordWithList)) {
                return false;
            }

            NestedStaticLevel2RecordWithList that = (NestedStaticLevel2RecordWithList) o;
            return Objects.equals(attr, that.attr) && Objects.equals(time, that.time) && Objects.equals(level3, that.level3) && Objects.equals(level3List, that.level3List);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level3);
            result = 31 * result + Objects.hashCode(level3List);
            return result;
        }
    }

    public static class NestedStaticLevel3RecordWithList {
        private String attr;
        private Instant time;
        private NestedStaticLevel4Record level4;
        private List<NestedStaticLevel4Record> level4List;


        public String getAttr() {
            return attr;
        }

        public NestedStaticLevel3RecordWithList setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public NestedStaticLevel3RecordWithList setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedStaticLevel4Record getLevel4() {
            return level4;
        }

        public NestedStaticLevel3RecordWithList setLevel4(NestedStaticLevel4Record level4) {
            this.level4 = level4;
            return this;
        }

        public List<NestedStaticLevel4Record> getLevel4List() {
            return level4List;
        }

        public NestedStaticLevel3RecordWithList setLevel4List(List<NestedStaticLevel4Record> level4List) {
            this.level4List = level4List;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedStaticLevel3RecordWithList)) {
                return false;
            }

            NestedStaticLevel3RecordWithList that = (NestedStaticLevel3RecordWithList) o;
            return Objects.equals(attr, that.attr) && Objects.equals(time, that.time) && Objects.equals(level4, that.level4) && Objects.equals(level4List, that.level4List);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level4);
            result = 31 * result + Objects.hashCode(level4List);
            return result;
        }
    }

    public static class NestedStaticRecordWithSet {
        private String id;
        private String attr;
        private Instant time;
        private NestedStaticLevel2RecordWithSet level2;
        private Set<NestedStaticLevel2RecordWithSet> level2List;

        public String getId() {
            return id;
        }

        public NestedStaticRecordWithSet setId(String id) {
            this.id = id;
            return this;
        }


        public String getAttr() {
            return attr;
        }

        public NestedStaticRecordWithSet setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public NestedStaticRecordWithSet setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedStaticLevel2RecordWithSet getLevel2() {
            return level2;
        }

        public NestedStaticRecordWithSet setLevel2(NestedStaticLevel2RecordWithSet level2) {
            this.level2 = level2;
            return this;
        }

        public Set<NestedStaticLevel2RecordWithSet> getLevel2List() {
            return level2List;
        }

        public NestedStaticRecordWithSet setLevel2List(Set<NestedStaticLevel2RecordWithSet> level2List) {
            this.level2List = level2List;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedStaticRecordWithSet)) {
                return false;
            }

            NestedStaticRecordWithSet that = (NestedStaticRecordWithSet) o;
            return Objects.equals(id, that.id) && Objects.equals(attr, that.attr) && Objects.equals(time, that.time) && Objects.equals(level2, that.level2) && Objects.equals(level2List, that.level2List);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(id);
            result = 31 * result + Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level2);
            result = 31 * result + Objects.hashCode(level2List);
            return result;
        }
    }

    public static class NestedStaticLevel2RecordWithSet {
        private String attr;
        private Instant time;
        private NestedStaticLevel3RecordWithSet level3;
        private Set<NestedStaticLevel3RecordWithSet> level3Set;


        public String getAttr() {
            return attr;
        }

        public NestedStaticLevel2RecordWithSet setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public NestedStaticLevel2RecordWithSet setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedStaticLevel3RecordWithSet getLevel3() {
            return level3;
        }

        public NestedStaticLevel2RecordWithSet setLevel3(NestedStaticLevel3RecordWithSet level3) {
            this.level3 = level3;
            return this;
        }

        public Set<NestedStaticLevel3RecordWithSet> getLevel3Set() {
            return level3Set;
        }

        public NestedStaticLevel2RecordWithSet setLevel3Set(Set<NestedStaticLevel3RecordWithSet> level3Set) {
            this.level3Set = level3Set;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedStaticLevel2RecordWithSet)) {
                return false;
            }

            NestedStaticLevel2RecordWithSet that = (NestedStaticLevel2RecordWithSet) o;
            return Objects.equals(attr, that.attr) && Objects.equals(time, that.time) && Objects.equals(level3, that.level3) && Objects.equals(level3Set, that.level3Set);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level3);
            result = 31 * result + Objects.hashCode(level3Set);
            return result;
        }
    }

    public static class NestedStaticLevel3RecordWithSet {
        private String attr;
        private Instant time;
        private NestedStaticLevel4Record level4;
        private Set<NestedStaticLevel4Record> level4Set;


        public String getAttr() {
            return attr;
        }

        public NestedStaticLevel3RecordWithSet setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public NestedStaticLevel3RecordWithSet setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedStaticLevel4Record getLevel4() {
            return level4;
        }

        public NestedStaticLevel3RecordWithSet setLevel4(NestedStaticLevel4Record level4) {
            this.level4 = level4;
            return this;
        }

        public Set<NestedStaticLevel4Record> getLevel4Set() {
            return level4Set;
        }

        public NestedStaticLevel3RecordWithSet setLevel4Set(Set<NestedStaticLevel4Record> level4Set) {
            this.level4Set = level4Set;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedStaticLevel3RecordWithSet)) {
                return false;
            }

            NestedStaticLevel3RecordWithSet that = (NestedStaticLevel3RecordWithSet) o;
            return Objects.equals(attr, that.attr) && Objects.equals(time, that.time) && Objects.equals(level4, that.level4) && Objects.equals(level4Set, that.level4Set);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level4);
            result = 31 * result + Objects.hashCode(level4Set);
            return result;
        }
    }

    public static class NestedStaticRecordWithMap {
        private String id;
        private String attr;
        private Instant time;
        private NestedStaticLevel2RecordWithMap level2;
        private Map<String, NestedStaticLevel2RecordWithMap> level2Map;

        public String getId() {
            return id;
        }

        public NestedStaticRecordWithMap setId(String id) {
            this.id = id;
            return this;
        }


        public String getAttr() {
            return attr;
        }

        public NestedStaticRecordWithMap setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public NestedStaticRecordWithMap setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedStaticLevel2RecordWithMap getLevel2() {
            return level2;
        }

        public NestedStaticRecordWithMap setLevel2(NestedStaticLevel2RecordWithMap level2) {
            this.level2 = level2;
            return this;
        }

        public Map<String, NestedStaticLevel2RecordWithMap> getLevel2Map() {
            return level2Map;
        }

        public NestedStaticRecordWithMap setLevel2Map(Map<String, NestedStaticLevel2RecordWithMap> level2Map) {
            this.level2Map = level2Map;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedStaticRecordWithMap)) {
                return false;
            }

            NestedStaticRecordWithMap that = (NestedStaticRecordWithMap) o;
            return Objects.equals(id, that.id) && Objects.equals(attr, that.attr) && Objects.equals(time, that.time) && Objects.equals(level2, that.level2) && Objects.equals(level2Map, that.level2Map);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(id);
            result = 31 * result + Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level2);
            result = 31 * result + Objects.hashCode(level2Map);
            return result;
        }
    }

    public static class NestedStaticLevel2RecordWithMap {
        private String attr;
        private Instant time;
        private NestedStaticLevel3RecordWithMap level3;
        private Map<String, NestedStaticLevel3RecordWithMap> level3Map;


        public String getAttr() {
            return attr;
        }

        public NestedStaticLevel2RecordWithMap setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public NestedStaticLevel2RecordWithMap setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedStaticLevel3RecordWithMap getLevel3() {
            return level3;
        }

        public NestedStaticLevel2RecordWithMap setLevel3(NestedStaticLevel3RecordWithMap level3) {
            this.level3 = level3;
            return this;
        }

        public Map<String, NestedStaticLevel3RecordWithMap> getLevel3Map() {
            return level3Map;
        }

        public NestedStaticLevel2RecordWithMap setLevel3Map(Map<String, NestedStaticLevel3RecordWithMap> level3Map) {
            this.level3Map = level3Map;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedStaticLevel2RecordWithMap)) {
                return false;
            }

            NestedStaticLevel2RecordWithMap that = (NestedStaticLevel2RecordWithMap) o;
            return Objects.equals(attr, that.attr) && Objects.equals(time, that.time) && Objects.equals(level3, that.level3) && Objects.equals(level3Map, that.level3Map);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level3);
            result = 31 * result + Objects.hashCode(level3Map);
            return result;
        }
    }

    public static class NestedStaticLevel3RecordWithMap {
        private String attr;
        private Instant time;
        private NestedStaticLevel4Record level4;
        private Map<String, NestedStaticLevel4Record> level4Map;

        public String getAttr() {
            return attr;
        }

        public NestedStaticLevel3RecordWithMap setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public NestedStaticLevel3RecordWithMap setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedStaticLevel4Record getLevel4() {
            return level4;
        }

        public NestedStaticLevel3RecordWithMap setLevel4(NestedStaticLevel4Record level4) {
            this.level4 = level4;
            return this;
        }

        public Map<String, NestedStaticLevel4Record> getLevel4Map() {
            return level4Map;
        }

        public NestedStaticLevel3RecordWithMap setLevel4Map(Map<String, NestedStaticLevel4Record> level4Map) {
            this.level4Map = level4Map;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedStaticLevel3RecordWithMap)) {
                return false;
            }

            NestedStaticLevel3RecordWithMap that = (NestedStaticLevel3RecordWithMap) o;
            return Objects.equals(attr, that.attr) && Objects.equals(time, that.time) && Objects.equals(level4, that.level4) && Objects.equals(level4Map, that.level4Map);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            result = 31 * result + Objects.hashCode(level4);
            result = 31 * result + Objects.hashCode(level4Map);
            return result;
        }
    }

    // nested record used by list/set/map as the deepest nested level
    public static class NestedStaticLevel4Record {
        private String attr;
        private Instant time;

        public String getAttr() {
            return attr;
        }

        public NestedStaticLevel4Record setAttr(String attr) {
            this.attr = attr;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public NestedStaticLevel4Record setTime(Instant time) {
            this.time = time;
            return this;
        }

        @Override
        public final boolean equals(Object o) {
            if (!(o instanceof NestedStaticLevel4Record)) {
                return false;
            }

            NestedStaticLevel4Record that = (NestedStaticLevel4Record) o;
            return Objects.equals(attr, that.attr) && Objects.equals(time, that.time);
        }

        @Override
        public int hashCode() {
            int result = Objects.hashCode(attr);
            result = 31 * result + Objects.hashCode(time);
            return result;
        }
    }


    // Bean Table Schemas for Simple Records
    public static TableSchema<SimpleBeanRecordWithList> buildBeanSchemaForSimpleRecordWithList() {
        return BeanTableSchema.create(SimpleBeanRecordWithList.class);
    }

    public static TableSchema<SimpleBeanRecordWithSet> buildBeanSchemaForSimpleRecordWithSet() {
        return BeanTableSchema.create(SimpleBeanRecordWithSet.class);
    }

    public static TableSchema<SimpleBeanRecordWithMap> buildBeanSchemaForSimpleRecordWithMap() {
        return BeanTableSchema.create(SimpleBeanRecordWithMap.class);
    }

    // Bean Table Schemas for Nested Records
    public static TableSchema<NestedBeanRecordWithList> buildBeanSchemaForNestedRecordWithList() {
        return BeanTableSchema.create(NestedBeanRecordWithList.class);
    }

    public static TableSchema<NestedBeanRecordWithSet> buildBeanSchemaForNestedRecordWithSet() {
        return BeanTableSchema.create(NestedBeanRecordWithSet.class);
    }

    public static TableSchema<NestedBeanRecordWithMap> buildBeanSchemaForNestedRecordWithMap() {
        return BeanTableSchema.create(NestedBeanRecordWithMap.class);
    }


    // Immutable Table Schemas for Simple Records
    public static TableSchema<SimpleImmutableRecordWithList> buildImmutableSchemaForSimpleRecordWithList() {
        return ImmutableTableSchema.create(SimpleImmutableRecordWithList.class);
    }

    public static TableSchema<SimpleImmutableRecordWithSet> buildImmutableSchemaForSimpleRecordWithSet() {
        return ImmutableTableSchema.create(SimpleImmutableRecordWithSet.class);
    }

    public static TableSchema<SimpleImmutableRecordWithMap> buildImmutableSchemaForSimpleRecordWithMap() {
        return ImmutableTableSchema.create(SimpleImmutableRecordWithMap.class);
    }


    // Immutable Table Schemas for Nested Records
    public static TableSchema<NestedImmutableRecordWithList> buildImmutableSchemaForNestedRecordWithList() {
        return ImmutableTableSchema.create(NestedImmutableRecordWithList.class);
    }

    public static TableSchema<NestedImmutableRecordWithSet> buildImmutableSchemaForNestedRecordWithSet() {
        return ImmutableTableSchema.create(NestedImmutableRecordWithSet.class);
    }

    public static TableSchema<NestedImmutableRecordWithMap> buildImmutableSchemaForNestedRecordWithMap() {
        return ImmutableTableSchema.create(NestedImmutableRecordWithMap.class);
    }


    // Static Table Schemas for Simple Records
    public static TableSchema<SimpleStaticRecordWithList> buildStaticSchemaForSimpleRecordWithList() {
        return StaticTableSchema.builder(SimpleStaticRecordWithList.class)
                                .newItemSupplier(SimpleStaticRecordWithList::new)
                                .addAttribute(String.class,
                                              a -> a.name("id")
                                                    .getter(SimpleStaticRecordWithList::getId)
                                                    .setter(SimpleStaticRecordWithList::setId)
                                                    .tags(primaryPartitionKey()))
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(SimpleStaticRecordWithList::getAttr)
                                                    .setter(SimpleStaticRecordWithList::setAttr)
                                                    .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(SimpleStaticRecordWithList::getTime)
                                                    .setter(SimpleStaticRecordWithList::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.listOf(EnhancedType.documentOf(
                                                  SimpleStaticChild.class,
                                                  buildStaticSchemaForSimpleChildRecord())),
                                              a -> a.name("childList")
                                                    .getter(SimpleStaticRecordWithList::getChildList)
                                                    .setter(SimpleStaticRecordWithList::setChildList))
                                .build();
    }

    public static StaticTableSchema<SimpleStaticRecordWithSet> buildStaticSchemaForSimpleRecordWithSet() {
        return StaticTableSchema.builder(SimpleStaticRecordWithSet.class)
                                .newItemSupplier(SimpleStaticRecordWithSet::new)
                                .addAttribute(String.class,
                                              a -> a.name("id")
                                                    .getter(SimpleStaticRecordWithSet::getId)
                                                    .setter(SimpleStaticRecordWithSet::setId)
                                                    .tags(primaryPartitionKey()))
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(SimpleStaticRecordWithSet::getAttr)
                                                    .setter(SimpleStaticRecordWithSet::setAttr))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(SimpleStaticRecordWithSet::getTime)
                                                    .setter(SimpleStaticRecordWithSet::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.setOf(
                                                  EnhancedType.documentOf(
                                                      SimpleStaticChild.class,
                                                      buildStaticSchemaForSimpleChildRecord())),
                                              a -> a.name("childSet")
                                                    .getter(SimpleStaticRecordWithSet::getChildSet)
                                                    .setter(SimpleStaticRecordWithSet::setChildSet))
                                .build();
    }

    public static TableSchema<SimpleStaticRecordWithMap> buildStaticSchemaForSimpleRecordWithMap() {
        return StaticTableSchema.builder(SimpleStaticRecordWithMap.class)
                                .newItemSupplier(SimpleStaticRecordWithMap::new)
                                .addAttribute(String.class,
                                              a -> a.name("id")
                                                    .getter(SimpleStaticRecordWithMap::getId)
                                                    .setter(SimpleStaticRecordWithMap::setId)
                                                    .tags(primaryPartitionKey()))
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(SimpleStaticRecordWithMap::getAttr)
                                                    .setter(SimpleStaticRecordWithMap::setAttr))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(SimpleStaticRecordWithMap::getTime)
                                                    .setter(SimpleStaticRecordWithMap::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.mapOf(
                                                  String.class, SimpleStaticChild.class),
                                              a -> a.name("childMap")
                                                    .getter(SimpleStaticRecordWithMap::getChildMap)
                                                    .setter(SimpleStaticRecordWithMap::setChildMap))
                                .build();
    }

    // schema of the simple record used by list/set/map as the deepest simple level
    public static TableSchema<SimpleStaticChild> buildStaticSchemaForSimpleChildRecord() {
        return StaticTableSchema.builder(SimpleStaticChild.class)
                                .newItemSupplier(SimpleStaticChild::new)
                                .addAttribute(String.class,
                                              a -> a.name("id")
                                                    .getter(SimpleStaticChild::getId)
                                                    .setter(SimpleStaticChild::setId)
                                                    .tags(primaryPartitionKey()))
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(SimpleStaticChild::getAttr)
                                                    .setter(SimpleStaticChild::setAttr)
                                                    .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(SimpleStaticChild::getTime)
                                                    .setter(SimpleStaticChild::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .build();
    }


    // Static Table Schemas for Nested Records
    public static TableSchema<NestedStaticRecordWithList> buildStaticSchemaForNestedRecordWithList() {
        return StaticTableSchema.builder(NestedStaticRecordWithList.class)
                                .newItemSupplier(NestedStaticRecordWithList::new)
                                .addAttribute(String.class,
                                              a -> a.name("id")
                                                    .getter(NestedStaticRecordWithList::getId)
                                                    .setter(NestedStaticRecordWithList::setId)
                                                    .tags(primaryPartitionKey()))
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(NestedStaticRecordWithList::getAttr)
                                                    .setter(NestedStaticRecordWithList::setAttr)
                                                    .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(NestedStaticRecordWithList::getTime)
                                                    .setter(NestedStaticRecordWithList::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.documentOf(
                                                  NestedStaticLevel2RecordWithList.class,
                                                  buildStaticSchemaForNestedLevel2RecordWithList()),
                                              a -> a.name("level2")
                                                    .getter(NestedStaticRecordWithList::getLevel2)
                                                    .setter(NestedStaticRecordWithList::setLevel2))
                                .addAttribute(EnhancedType.listOf(EnhancedType.documentOf(
                                                  NestedStaticLevel2RecordWithList.class,
                                                  buildStaticSchemaForNestedLevel2RecordWithList())),
                                              a -> a.name("level2List")
                                                    .getter(NestedStaticRecordWithList::getLevel2List)
                                                    .setter(NestedStaticRecordWithList::setLevel2List))
                                .build();
    }

    public static TableSchema<NestedStaticLevel2RecordWithList> buildStaticSchemaForNestedLevel2RecordWithList() {
        return StaticTableSchema.builder(NestedStaticLevel2RecordWithList.class)
                                .newItemSupplier(NestedStaticLevel2RecordWithList::new)
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(NestedStaticLevel2RecordWithList::getAttr)
                                                    .setter(NestedStaticLevel2RecordWithList::setAttr)
                                                    .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(NestedStaticLevel2RecordWithList::getTime)
                                                    .setter(NestedStaticLevel2RecordWithList::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.documentOf(
                                                  NestedStaticLevel3RecordWithList.class,
                                                  buildStaticSchemaForNestedLevel3RecordWithList()),
                                              a -> a.name("level3")
                                                    .getter(NestedStaticLevel2RecordWithList::getLevel3)
                                                    .setter(NestedStaticLevel2RecordWithList::setLevel3))
                                .addAttribute(EnhancedType.listOf(EnhancedType.documentOf(
                                                  NestedStaticLevel3RecordWithList.class,
                                                  buildStaticSchemaForNestedLevel3RecordWithList())),
                                              a -> a.name("level3List")
                                                    .getter(NestedStaticLevel2RecordWithList::getLevel3List)
                                                    .setter(NestedStaticLevel2RecordWithList::setLevel3List))
                                .build();
    }

    public static TableSchema<NestedStaticLevel3RecordWithList> buildStaticSchemaForNestedLevel3RecordWithList() {
        return StaticTableSchema.builder(NestedStaticLevel3RecordWithList.class)
                                .newItemSupplier(NestedStaticLevel3RecordWithList::new)
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(NestedStaticLevel3RecordWithList::getAttr)
                                                    .setter(NestedStaticLevel3RecordWithList::setAttr)
                                                    .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(NestedStaticLevel3RecordWithList::getTime)
                                                    .setter(NestedStaticLevel3RecordWithList::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.documentOf(
                                                  NestedStaticLevel4Record.class,
                                                  buildStaticSchemaForNestedLevel4Record()),
                                              a -> a.name("level4")
                                                    .getter(NestedStaticLevel3RecordWithList::getLevel4)
                                                    .setter(NestedStaticLevel3RecordWithList::setLevel4))
                                .addAttribute(EnhancedType.listOf(
                                                  EnhancedType.documentOf(
                                                      NestedStaticLevel4Record.class,
                                                      buildStaticSchemaForNestedLevel4Record())),
                                              a -> a.name("level4List")
                                                    .getter(NestedStaticLevel3RecordWithList::getLevel4List)
                                                    .setter(NestedStaticLevel3RecordWithList::setLevel4List))
                                .build();
    }

    public static TableSchema<NestedStaticRecordWithSet> buildStaticSchemaForNestedRecordWithSet() {
        return StaticTableSchema.builder(NestedStaticRecordWithSet.class)
                                .newItemSupplier(NestedStaticRecordWithSet::new)
                                .addAttribute(String.class,
                                              a -> a.name("id")
                                                    .getter(NestedStaticRecordWithSet::getId)
                                                    .setter(NestedStaticRecordWithSet::setId)
                                                    .tags(primaryPartitionKey()))
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(NestedStaticRecordWithSet::getAttr)
                                                    .setter(NestedStaticRecordWithSet::setAttr))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(NestedStaticRecordWithSet::getTime)
                                                    .setter(NestedStaticRecordWithSet::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.documentOf(
                                                  NestedStaticLevel2RecordWithSet.class,
                                                  buildStaticSchemaForNestedLevel2RecordWithSet()),
                                              a -> a.name("level2")
                                                    .getter(NestedStaticRecordWithSet::getLevel2)
                                                    .setter(NestedStaticRecordWithSet::setLevel2))
                                .addAttribute(EnhancedType.setOf(EnhancedType.documentOf(
                                                  NestedStaticLevel2RecordWithSet.class,
                                                  buildStaticSchemaForNestedLevel2RecordWithSet())),
                                              a -> a.name("level2Set")
                                                    .getter(NestedStaticRecordWithSet::getLevel2List)
                                                    .setter(NestedStaticRecordWithSet::setLevel2List))
                                .build();
    }

    public static TableSchema<NestedStaticLevel2RecordWithSet> buildStaticSchemaForNestedLevel2RecordWithSet() {
        return StaticTableSchema.builder(NestedStaticLevel2RecordWithSet.class)
                                .newItemSupplier(NestedStaticLevel2RecordWithSet::new)
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(NestedStaticLevel2RecordWithSet::getAttr)
                                                    .setter(NestedStaticLevel2RecordWithSet::setAttr))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(NestedStaticLevel2RecordWithSet::getTime)
                                                    .setter(NestedStaticLevel2RecordWithSet::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.documentOf(
                                                  NestedStaticLevel3RecordWithSet.class,
                                                  buildStaticSchemaForNestedLevel3RecordWithSet()),
                                              a -> a.name("level3")
                                                    .getter(NestedStaticLevel2RecordWithSet::getLevel3)
                                                    .setter(NestedStaticLevel2RecordWithSet::setLevel3))
                                .addAttribute(EnhancedType.setOf(EnhancedType.documentOf(
                                                  NestedStaticLevel3RecordWithSet.class,
                                                  buildStaticSchemaForNestedLevel3RecordWithSet())),
                                              a -> a.name("level3Set")
                                                    .getter(NestedStaticLevel2RecordWithSet::getLevel3Set)
                                                    .setter(NestedStaticLevel2RecordWithSet::setLevel3Set))
                                .build();
    }

    public static TableSchema<NestedStaticLevel3RecordWithSet> buildStaticSchemaForNestedLevel3RecordWithSet() {
        return StaticTableSchema.builder(NestedStaticLevel3RecordWithSet.class)
                                .newItemSupplier(NestedStaticLevel3RecordWithSet::new)
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(NestedStaticLevel3RecordWithSet::getAttr)
                                                    .setter(NestedStaticLevel3RecordWithSet::setAttr))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(NestedStaticLevel3RecordWithSet::getTime)
                                                    .setter(NestedStaticLevel3RecordWithSet::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.documentOf(
                                                  NestedStaticLevel4Record.class,
                                                  buildStaticSchemaForNestedLevel4Record()),
                                              a -> a.name("level4")
                                                    .getter(NestedStaticLevel3RecordWithSet::getLevel4)
                                                    .setter(NestedStaticLevel3RecordWithSet::setLevel4))
                                .addAttribute(EnhancedType.setOf(
                                                  EnhancedType.documentOf(
                                                      NestedStaticLevel4Record.class,
                                                      buildStaticSchemaForNestedLevel4Record())),
                                              a -> a.name("level4List")
                                                    .getter(NestedStaticLevel3RecordWithSet::getLevel4Set)
                                                    .setter(NestedStaticLevel3RecordWithSet::setLevel4Set))
                                .build();
    }

    public static TableSchema<NestedStaticRecordWithMap> buildStaticSchemaForNestedRecordWithMap() {
        return StaticTableSchema.builder(NestedStaticRecordWithMap.class)
                                .newItemSupplier(NestedStaticRecordWithMap::new)
                                .addAttribute(String.class,
                                              a -> a.name("id")
                                                    .getter(NestedStaticRecordWithMap::getId)
                                                    .setter(NestedStaticRecordWithMap::setId)
                                                    .tags(primaryPartitionKey()))
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(NestedStaticRecordWithMap::getAttr)
                                                    .setter(NestedStaticRecordWithMap::setAttr))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(NestedStaticRecordWithMap::getTime)
                                                    .setter(NestedStaticRecordWithMap::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.documentOf(
                                                  NestedStaticLevel2RecordWithMap.class,
                                                  buildStaticSchemaForNestedLevel2RecordWithMap()),
                                              a -> a.name("level2")
                                                    .getter(NestedStaticRecordWithMap::getLevel2)
                                                    .setter(NestedStaticRecordWithMap::setLevel2))
                                .addAttribute(EnhancedType.mapOf(
                                                  String.class, NestedStaticLevel2RecordWithMap.class),
                                              a -> a.name("level2Map")
                                                    .getter(NestedStaticRecordWithMap::getLevel2Map)
                                                    .setter(NestedStaticRecordWithMap::setLevel2Map))
                                .build();
    }

    public static TableSchema<NestedStaticLevel2RecordWithMap> buildStaticSchemaForNestedLevel2RecordWithMap() {
        return StaticTableSchema.builder(NestedStaticLevel2RecordWithMap.class)
                                .newItemSupplier(NestedStaticLevel2RecordWithMap::new)
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(NestedStaticLevel2RecordWithMap::getAttr)
                                                    .setter(NestedStaticLevel2RecordWithMap::setAttr))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(NestedStaticLevel2RecordWithMap::getTime)
                                                    .setter(NestedStaticLevel2RecordWithMap::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.documentOf(
                                                  NestedStaticLevel3RecordWithMap.class,
                                                  buildStaticSchemaForNestedLevel3RecordWithMap()),
                                              a -> a.name("level3")
                                                    .getter(NestedStaticLevel2RecordWithMap::getLevel3)
                                                    .setter(NestedStaticLevel2RecordWithMap::setLevel3))
                                .addAttribute(EnhancedType.mapOf(
                                                  String.class, NestedStaticLevel3RecordWithMap.class),
                                              a -> a.name("level3Map")
                                                    .getter(NestedStaticLevel2RecordWithMap::getLevel3Map)
                                                    .setter(NestedStaticLevel2RecordWithMap::setLevel3Map))
                                .build();
    }

    public static TableSchema<NestedStaticLevel3RecordWithMap> buildStaticSchemaForNestedLevel3RecordWithMap() {
        return StaticTableSchema.builder(NestedStaticLevel3RecordWithMap.class)
                                .newItemSupplier(NestedStaticLevel3RecordWithMap::new)
                                .addAttribute(String.class,
                                              a -> a.name("attr")
                                                    .getter(NestedStaticLevel3RecordWithMap::getAttr)
                                                    .setter(NestedStaticLevel3RecordWithMap::setAttr))
                                .addAttribute(Instant.class,
                                              a -> a.name("time")
                                                    .getter(NestedStaticLevel3RecordWithMap::getTime)
                                                    .setter(NestedStaticLevel3RecordWithMap::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.documentOf(
                                                  NestedStaticLevel4Record.class,
                                                  buildStaticSchemaForNestedLevel4Record()),
                                              a -> a.name("level4")
                                                    .getter(NestedStaticLevel3RecordWithMap::getLevel4)
                                                    .setter(NestedStaticLevel3RecordWithMap::setLevel4))
                                .addAttribute(EnhancedType.mapOf(
                                                  String.class, NestedStaticLevel4Record.class),
                                              a -> a.name("level4Map")
                                                    .getter(NestedStaticLevel3RecordWithMap::getLevel4Map)
                                                    .setter(NestedStaticLevel3RecordWithMap::setLevel4Map))
                                .build();
    }

    // schema of the nested record used by list/set/map as the deepest nested level
    public static TableSchema<NestedStaticLevel4Record> buildStaticSchemaForNestedLevel4Record() {
        return StaticTableSchema.builder(NestedStaticLevel4Record.class)
                                .newItemSupplier(NestedStaticLevel4Record::new)
                                .addAttribute(String.class,
                                              x -> x.name("attr")
                                                    .getter(NestedStaticLevel4Record::getAttr)
                                                    .setter(NestedStaticLevel4Record::setAttr)
                                                    .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                .addAttribute(Instant.class,
                                              x -> x.name("time")
                                                    .getter(NestedStaticLevel4Record::getTime)
                                                    .setter(NestedStaticLevel4Record::setTime)
                                                    .tags(autoGeneratedTimestampAttribute()))
                                .build();
    }


    // Static Immutable Table Schemas for Simple Records
    public static TableSchema<SimpleImmutableChild> buildStaticImmutableSchemaForSimpleChildRecord() {
        return StaticImmutableTableSchema.builder(SimpleImmutableChild.class, SimpleImmutableChild.Builder.class)
                                         .newItemBuilder(SimpleImmutableChild::builder, SimpleImmutableChild.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("id")
                                                             .getter(SimpleImmutableChild::getId)
                                                             .setter(SimpleImmutableChild.Builder::id)
                                                             .tags(primaryPartitionKey()))
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(SimpleImmutableChild::getAttr)
                                                             .setter(SimpleImmutableChild.Builder::attr)
                                                             .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(SimpleImmutableChild::getTime)
                                                             .setter(SimpleImmutableChild.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .build();
    }

    public static TableSchema<SimpleImmutableRecordWithList> buildStaticImmutableSchemaForSimpleRecordWithList() {
        return StaticImmutableTableSchema.builder(SimpleImmutableRecordWithList.class,
                                                  SimpleImmutableRecordWithList.Builder.class)
                                         .newItemBuilder(SimpleImmutableRecordWithList::builder,
                                                         SimpleImmutableRecordWithList.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("id")
                                                             .getter(SimpleImmutableRecordWithList::getId)
                                                             .setter(SimpleImmutableRecordWithList.Builder::id)
                                                             .tags(primaryPartitionKey()))
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(SimpleImmutableRecordWithList::getAttr)
                                                             .setter(SimpleImmutableRecordWithList.Builder::attr)
                                                             .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(SimpleImmutableRecordWithList::getTime)
                                                             .setter(SimpleImmutableRecordWithList.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.listOf(
                                                           EnhancedType.documentOf(
                                                               SimpleImmutableChild.class,
                                                               buildStaticImmutableSchemaForSimpleChildRecord())),
                                                       a -> a.name("childList")
                                                             .getter(SimpleImmutableRecordWithList::getChildList)
                                                             .setter(SimpleImmutableRecordWithList.Builder::childList))
                                         .build();
    }

    public static StaticImmutableTableSchema<SimpleImmutableRecordWithSet, SimpleImmutableRecordWithSet.Builder> buildStaticImmutableSchemaForSimpleRecordWithSet() {
        return StaticImmutableTableSchema.builder(SimpleImmutableRecordWithSet.class, SimpleImmutableRecordWithSet.Builder.class)
                                         .newItemBuilder(SimpleImmutableRecordWithSet::builder,
                                                         SimpleImmutableRecordWithSet.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("id")
                                                             .getter(SimpleImmutableRecordWithSet::getId)
                                                             .setter(SimpleImmutableRecordWithSet.Builder::id)
                                                             .tags(primaryPartitionKey()))
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(SimpleImmutableRecordWithSet::getAttr)
                                                             .setter(SimpleImmutableRecordWithSet.Builder::attr))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(SimpleImmutableRecordWithSet::getTime)
                                                             .setter(SimpleImmutableRecordWithSet.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.setOf(
                                                           EnhancedType.documentOf(
                                                               SimpleImmutableChild.class,
                                                               buildStaticImmutableSchemaForSimpleChildRecord())),
                                                       a -> a.name("childSet")
                                                             .getter(SimpleImmutableRecordWithSet::getChildSet)
                                                             .setter(SimpleImmutableRecordWithSet.Builder::childSet))
                                         .build();
    }

    public static TableSchema<SimpleImmutableRecordWithMap> buildStaticImmutableSchemaForSimpleRecordWithMap() {
        return StaticImmutableTableSchema.builder(SimpleImmutableRecordWithMap.class, SimpleImmutableRecordWithMap.Builder.class)
                                         .newItemBuilder(SimpleImmutableRecordWithMap::builder,
                                                         SimpleImmutableRecordWithMap.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("id")
                                                             .getter(SimpleImmutableRecordWithMap::getId)
                                                             .setter(SimpleImmutableRecordWithMap.Builder::id)
                                                             .tags(primaryPartitionKey()))
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(SimpleImmutableRecordWithMap::getAttr)
                                                             .setter(SimpleImmutableRecordWithMap.Builder::attr))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(SimpleImmutableRecordWithMap::getTime)
                                                             .setter(SimpleImmutableRecordWithMap.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.mapOf(
                                                           String.class, SimpleImmutableChild.class),
                                                       a -> a.name("childMap")
                                                             .getter(SimpleImmutableRecordWithMap::getChildMap)
                                                             .setter(SimpleImmutableRecordWithMap.Builder::childMap))
                                         .build();
    }


    // Static Immutable Table Schemas for Nested Records
    public static TableSchema<NestedImmutableRecordWithList> buildStaticImmutableSchemaForNestedRecordWithList() {
        return StaticImmutableTableSchema.builder(NestedImmutableRecordWithList.class,
                                                  NestedImmutableRecordWithList.Builder.class)
                                         .newItemBuilder(NestedImmutableRecordWithList::builder,
                                                         NestedImmutableRecordWithList.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("id")
                                                             .getter(NestedImmutableRecordWithList::getId)
                                                             .setter(NestedImmutableRecordWithList.Builder::id)
                                                             .tags(primaryPartitionKey()))
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(NestedImmutableRecordWithList::getAttr)
                                                             .setter(NestedImmutableRecordWithList.Builder::attr)
                                                             .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(NestedImmutableRecordWithList::getTime)
                                                             .setter(NestedImmutableRecordWithList.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.documentOf(
                                                           NestedImmutableLevel2RecordWithList.class,
                                                           buildStaticImmutableSchemaForNestedLevel2RecordWithList()),
                                                       a -> a.name("level2")
                                                             .getter(NestedImmutableRecordWithList::getLevel2)
                                                             .setter(NestedImmutableRecordWithList.Builder::level2))
                                         .addAttribute(EnhancedType.listOf(
                                                           EnhancedType.documentOf(
                                                               NestedImmutableLevel2RecordWithList.class,
                                                               buildStaticImmutableSchemaForNestedLevel2RecordWithList())),
                                                       a -> a.name("level2List")
                                                             .getter(NestedImmutableRecordWithList::getLevel2List)
                                                             .setter(NestedImmutableRecordWithList.Builder::level2List))
                                         .build();
    }

    public static TableSchema<NestedImmutableLevel2RecordWithList> buildStaticImmutableSchemaForNestedLevel2RecordWithList() {
        return StaticImmutableTableSchema.builder(NestedImmutableLevel2RecordWithList.class,
                                                  NestedImmutableLevel2RecordWithList.Builder.class)
                                         .newItemBuilder(NestedImmutableLevel2RecordWithList::builder,
                                                         NestedImmutableLevel2RecordWithList.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(NestedImmutableLevel2RecordWithList::getAttr)
                                                             .setter(NestedImmutableLevel2RecordWithList.Builder::attr)
                                                             .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(NestedImmutableLevel2RecordWithList::getTime)
                                                             .setter(NestedImmutableLevel2RecordWithList.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.documentOf(
                                                           NestedImmutableLevel3RecordWithList.class,
                                                           buildStaticImmutableSchemaForNestedLevel3RecordWithList()),
                                                       a -> a.name("level3")
                                                             .getter(NestedImmutableLevel2RecordWithList::getLevel3)
                                                             .setter(NestedImmutableLevel2RecordWithList.Builder::level3))
                                         .addAttribute(EnhancedType.listOf(
                                                           EnhancedType.documentOf(
                                                               NestedImmutableLevel3RecordWithList.class,
                                                               buildStaticImmutableSchemaForNestedLevel3RecordWithList())),
                                                       a -> a.name("level3List")
                                                             .getter(NestedImmutableLevel2RecordWithList::getLevel3List)
                                                             .setter(NestedImmutableLevel2RecordWithList.Builder::level3List))
                                         .build();
    }

    public static TableSchema<NestedImmutableLevel3RecordWithList> buildStaticImmutableSchemaForNestedLevel3RecordWithList() {
        return StaticImmutableTableSchema.builder(NestedImmutableLevel3RecordWithList.class,
                                                  NestedImmutableLevel3RecordWithList.Builder.class)
                                         .newItemBuilder(NestedImmutableLevel3RecordWithList::builder,
                                                         NestedImmutableLevel3RecordWithList.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(NestedImmutableLevel3RecordWithList::getAttr)
                                                             .setter(NestedImmutableLevel3RecordWithList.Builder::attr)
                                                             .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(NestedImmutableLevel3RecordWithList::getTime)
                                                             .setter(NestedImmutableLevel3RecordWithList.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.documentOf(
                                                           NestedImmutableLevel4Record.class,
                                                           buildStaticImmutableSchemaForNestedLevel4Record()),
                                                       a -> a.name("level4")
                                                             .getter(NestedImmutableLevel3RecordWithList::getLevel4)
                                                             .setter(NestedImmutableLevel3RecordWithList.Builder::level4))
                                         .addAttribute(EnhancedType.listOf(
                                                           EnhancedType.documentOf(
                                                               NestedImmutableLevel4Record.class,
                                                               buildStaticImmutableSchemaForNestedLevel4Record())),
                                                       a -> a.name("level4List")
                                                             .getter(NestedImmutableLevel3RecordWithList::getLevel4List)
                                                             .setter(NestedImmutableLevel3RecordWithList.Builder::level4List))
                                         .build();
    }

    public static TableSchema<NestedImmutableRecordWithSet> buildStaticImmutableSchemaForNestedRecordWithSet() {
        return StaticImmutableTableSchema.builder(NestedImmutableRecordWithSet.class,
                                                  NestedImmutableRecordWithSet.Builder.class)
                                         .newItemBuilder(NestedImmutableRecordWithSet::builder,
                                                         NestedImmutableRecordWithSet.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("id")
                                                             .getter(NestedImmutableRecordWithSet::getId)
                                                             .setter(NestedImmutableRecordWithSet.Builder::id)
                                                             .tags(primaryPartitionKey()))
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(NestedImmutableRecordWithSet::getAttr)
                                                             .setter(NestedImmutableRecordWithSet.Builder::attr))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(NestedImmutableRecordWithSet::getTime)
                                                             .setter(NestedImmutableRecordWithSet.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.documentOf(
                                                           NestedImmutableLevel2RecordWithSet.class,
                                                           buildStaticImmutableSchemaForNestedLevel2RecordWithSet()),
                                                       a -> a.name("level2")
                                                             .getter(NestedImmutableRecordWithSet::getLevel2)
                                                             .setter(NestedImmutableRecordWithSet.Builder::level2))
                                         .addAttribute(EnhancedType.setOf(
                                                           EnhancedType.documentOf(
                                                               NestedImmutableLevel2RecordWithSet.class,
                                                               buildStaticImmutableSchemaForNestedLevel2RecordWithSet())),
                                                       a -> a.name("level2Set")
                                                             .getter(NestedImmutableRecordWithSet::getLevel2Set)
                                                             .setter(NestedImmutableRecordWithSet.Builder::level2Set))
                                         .build();
    }

    public static TableSchema<NestedImmutableLevel2RecordWithSet> buildStaticImmutableSchemaForNestedLevel2RecordWithSet() {
        return StaticImmutableTableSchema.builder(NestedImmutableLevel2RecordWithSet.class,
                                                  NestedImmutableLevel2RecordWithSet.Builder.class)
                                         .newItemBuilder(NestedImmutableLevel2RecordWithSet::builder,
                                                         NestedImmutableLevel2RecordWithSet.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(NestedImmutableLevel2RecordWithSet::getAttr)
                                                             .setter(NestedImmutableLevel2RecordWithSet.Builder::attr))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(NestedImmutableLevel2RecordWithSet::getTime)
                                                             .setter(NestedImmutableLevel2RecordWithSet.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.documentOf(
                                                           NestedImmutableLevel3RecordWithSet.class,
                                                           buildStaticImmutableSchemaForNestedLevel3RecordWithSet()),
                                                       a -> a.name("level3")
                                                             .getter(NestedImmutableLevel2RecordWithSet::getLevel3)
                                                             .setter(NestedImmutableLevel2RecordWithSet.Builder::level3))
                                         .addAttribute(EnhancedType.setOf(
                                                           EnhancedType.documentOf(
                                                               NestedImmutableLevel3RecordWithSet.class,
                                                               buildStaticImmutableSchemaForNestedLevel3RecordWithSet())),
                                                       a -> a.name("level3Set")
                                                             .getter(NestedImmutableLevel2RecordWithSet::getLevel3Set)
                                                             .setter(NestedImmutableLevel2RecordWithSet.Builder::level3Set))
                                         .build();
    }

    public static TableSchema<NestedImmutableLevel3RecordWithSet> buildStaticImmutableSchemaForNestedLevel3RecordWithSet() {
        return StaticImmutableTableSchema.builder(NestedImmutableLevel3RecordWithSet.class,
                                                  NestedImmutableLevel3RecordWithSet.Builder.class)
                                         .newItemBuilder(NestedImmutableLevel3RecordWithSet::builder,
                                                         NestedImmutableLevel3RecordWithSet.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(NestedImmutableLevel3RecordWithSet::getAttr)
                                                             .setter(NestedImmutableLevel3RecordWithSet.Builder::attr))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(NestedImmutableLevel3RecordWithSet::getTime)
                                                             .setter(NestedImmutableLevel3RecordWithSet.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.documentOf(
                                                           NestedImmutableLevel4Record.class,
                                                           buildStaticImmutableSchemaForNestedLevel4Record()),
                                                       a -> a.name("level4")
                                                             .getter(NestedImmutableLevel3RecordWithSet::getLevel4)
                                                             .setter(NestedImmutableLevel3RecordWithSet.Builder::level4))
                                         .addAttribute(EnhancedType.setOf(EnhancedType.documentOf(NestedImmutableLevel4Record.class,
                                                                                                  buildStaticImmutableSchemaForNestedLevel4Record())),
                                                       a -> a.name("level4Set")
                                                             .getter(NestedImmutableLevel3RecordWithSet::getLevel4Set)
                                                             .setter(NestedImmutableLevel3RecordWithSet.Builder::level4Set))
                                         .build();
    }

    public static TableSchema<NestedImmutableRecordWithMap> buildStaticImmutableSchemaForNestedRecordWithMap() {
        return StaticImmutableTableSchema.builder(NestedImmutableRecordWithMap.class,
                                                  NestedImmutableRecordWithMap.Builder.class)
                                         .newItemBuilder(NestedImmutableRecordWithMap::builder,
                                                         NestedImmutableRecordWithMap.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("id")
                                                             .getter(NestedImmutableRecordWithMap::getId)
                                                             .setter(NestedImmutableRecordWithMap.Builder::id)
                                                             .tags(primaryPartitionKey()))
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(NestedImmutableRecordWithMap::getAttr)
                                                             .setter(NestedImmutableRecordWithMap.Builder::attr))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(NestedImmutableRecordWithMap::getTime)
                                                             .setter(NestedImmutableRecordWithMap.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.documentOf(
                                                           NestedImmutableLevel2RecordWithMap.class,
                                                           buildStaticImmutableSchemaForNestedLevel2RecordWithMap()),
                                                       a -> a.name("level2")
                                                             .getter(NestedImmutableRecordWithMap::getLevel2)
                                                             .setter(NestedImmutableRecordWithMap.Builder::level2))
                                         .addAttribute(EnhancedType.mapOf(
                                                           String.class, NestedImmutableLevel2RecordWithMap.class),
                                                       a -> a.name("childMap")
                                                             .getter(NestedImmutableRecordWithMap::getLevel2Map)
                                                             .setter(NestedImmutableRecordWithMap.Builder::level2Map))
                                         .build();
    }

    public static TableSchema<NestedImmutableLevel2RecordWithMap> buildStaticImmutableSchemaForNestedLevel2RecordWithMap() {
        return StaticImmutableTableSchema.builder(NestedImmutableLevel2RecordWithMap.class,
                                                  NestedImmutableLevel2RecordWithMap.Builder.class)
                                         .newItemBuilder(NestedImmutableLevel2RecordWithMap::builder,
                                                         NestedImmutableLevel2RecordWithMap.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(NestedImmutableLevel2RecordWithMap::getAttr)
                                                             .setter(NestedImmutableLevel2RecordWithMap.Builder::attr))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(NestedImmutableLevel2RecordWithMap::getTime)
                                                             .setter(NestedImmutableLevel2RecordWithMap.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.documentOf(
                                                           NestedImmutableLevel3RecordWithMap.class,
                                                           buildStaticImmutableSchemaForNestedLevel3RecordWithMap()),
                                                       a -> a.name("level3")
                                                             .getter(NestedImmutableLevel2RecordWithMap::getLevel3)
                                                             .setter(NestedImmutableLevel2RecordWithMap.Builder::level3))
                                         .addAttribute(EnhancedType.mapOf(
                                                           String.class, NestedImmutableLevel3RecordWithMap.class),
                                                       a -> a.name("childMap")
                                                             .getter(NestedImmutableLevel2RecordWithMap::getLevel3Map)
                                                             .setter(NestedImmutableLevel2RecordWithMap.Builder::level3Map))
                                         .build();
    }

    public static TableSchema<NestedImmutableLevel3RecordWithMap> buildStaticImmutableSchemaForNestedLevel3RecordWithMap() {
        return StaticImmutableTableSchema.builder(NestedImmutableLevel3RecordWithMap.class,
                                                  NestedImmutableLevel3RecordWithMap.Builder.class)
                                         .newItemBuilder(NestedImmutableLevel3RecordWithMap::builder,
                                                         NestedImmutableLevel3RecordWithMap.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(NestedImmutableLevel3RecordWithMap::getAttr)
                                                             .setter(NestedImmutableLevel3RecordWithMap.Builder::attr))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(NestedImmutableLevel3RecordWithMap::getTime)
                                                             .setter(NestedImmutableLevel3RecordWithMap.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.documentOf(
                                                           NestedImmutableLevel4Record.class,
                                                           buildStaticImmutableSchemaForNestedLevel4Record()),
                                                       a -> a.name("level4")
                                                             .getter(NestedImmutableLevel3RecordWithMap::getLevel4)
                                                             .setter(NestedImmutableLevel3RecordWithMap.Builder::level4))
                                         .addAttribute(EnhancedType.mapOf(
                                                           String.class, NestedImmutableLevel4Record.class),
                                                       a -> a.name("level4Map")
                                                             .getter(NestedImmutableLevel3RecordWithMap::getLevel4Map)
                                                             .setter(NestedImmutableLevel3RecordWithMap.Builder::level4Map))
                                         .build();
    }

    // schema of the record used by list/set/map as the deepest nested level
    public static TableSchema<NestedImmutableLevel4Record> buildStaticImmutableSchemaForNestedLevel4Record() {
        return StaticImmutableTableSchema.builder(NestedImmutableLevel4Record.class, NestedImmutableLevel4Record.Builder.class)
                                         .newItemBuilder(NestedImmutableLevel4Record::builder,
                                                         NestedImmutableLevel4Record.Builder::build)
                                         .addAttribute(String.class,
                                                       a -> a.name("attr")
                                                             .getter(NestedImmutableLevel4Record::getAttr)
                                                             .setter(NestedImmutableLevel4Record.Builder::attr)
                                                             .tags(updateBehavior(UpdateBehavior.WRITE_IF_NOT_EXISTS)))
                                         .addAttribute(Instant.class,
                                                       a -> a.name("time")
                                                             .getter(NestedImmutableLevel4Record::getTime)
                                                             .setter(NestedImmutableLevel4Record.Builder::time)
                                                             .tags(autoGeneratedTimestampAttribute()))
                                         .build();
    }


    // Object builder methods
    public static SimpleBeanRecordWithList buildSimpleBeanRecordWithList() {
        return new SimpleBeanRecordWithList()
            .setId(ID_1).setAttr(ATTR_LEVEL1)
            .setChildList(new ArrayList<>(Arrays.asList(
                new SimpleBeanChild().setId(ID_1).setAttr(ATTR_CHILD1),
                new SimpleBeanChild().setId(ID_2).setAttr(ATTR_CHILD2))));
    }

    public static SimpleStaticRecordWithList buildSimpleStaticRecordWithList() {
        return new SimpleStaticRecordWithList()
            .setId(ID_1).setAttr(ATTR_LEVEL1)
            .setChildList(new ArrayList<>(Arrays.asList(
                new SimpleStaticChild().setId(ID_1).setAttr(ATTR_CHILD1),
                new SimpleStaticChild().setId(ID_2).setAttr(ATTR_CHILD2))));
    }

    public static SimpleImmutableRecordWithList buildSimpleImmutableRecordWithList() {
        return SimpleImmutableRecordWithList.builder()
                                            .id(ID_1).attr(ATTR_LEVEL1)
                                            .childList(new ArrayList<>(Arrays.asList(
                                                SimpleImmutableChild.builder().id(ID_1).attr(ATTR_CHILD1).build(),
                                                SimpleImmutableChild.builder().id(ID_2).attr(ATTR_CHILD2).build())))
                                            .build();
    }

    public static NestedBeanRecordWithList buildNestedBeanRecordWithList() {
        NestedBeanLevel4Record level4 =
            new NestedBeanLevel4Record()
                .setId(ID_1)
                .setAttr(ATTR_LEVEL4);

        NestedBeanLevel3RecordWithList level3 =
            new NestedBeanLevel3RecordWithList()
                .setAttr(ATTR_LEVEL3)
                .setLevel4(level4)
                .setLevel4List(new ArrayList<>(singletonList(level4)));

        NestedBeanLevel2RecordWithList level2 =
            new NestedBeanLevel2RecordWithList()
                .setAttr(ATTR_LEVEL2).setLevel3(level3)
                .setLevel3List(new ArrayList<>(singletonList(level3)));

        return new NestedBeanRecordWithList()
            .setId(ID_1).setAttr(ATTR_LEVEL1)
            .setLevel2(level2)
            .setLevel2List(new ArrayList<>(singletonList(level2)));
    }

    public static NestedStaticRecordWithList buildNestedStaticRecordWithList() {
        NestedStaticLevel4Record level4 =
            new NestedStaticLevel4Record()
                .setAttr(ATTR_LEVEL4);

        NestedStaticLevel3RecordWithList level3 =
            new NestedStaticLevel3RecordWithList()
                .setAttr(ATTR_LEVEL3)
                .setLevel4(level4)
                .setLevel4List(new ArrayList<>(singletonList(level4)));

        NestedStaticLevel2RecordWithList level2 =
            new NestedStaticLevel2RecordWithList()
                .setAttr(ATTR_LEVEL2)
                .setLevel3(level3)
                .setLevel3List(new ArrayList<>(singletonList(level3)));

        return new NestedStaticRecordWithList()
            .setId(ID_1)
            .setAttr(ATTR_LEVEL1)
            .setLevel2(level2)
            .setLevel2List(new ArrayList<>(singletonList(level2)));
    }

    public static NestedImmutableRecordWithList buildNestedImmutableRecordWithList() {
        NestedImmutableLevel4Record level4 =
            NestedImmutableLevel4Record.builder()
                                       .id(ID_ATTR)
                                       .attr(ATTR_LEVEL4)
                                       .build();

        NestedImmutableLevel3RecordWithList level3 =
            NestedImmutableLevel3RecordWithList.builder()
                                               .attr(ATTR_LEVEL3)
                                               .level4(level4)
                                               .level4List(new ArrayList<>(singletonList(level4)))
                                               .build();

        NestedImmutableLevel2RecordWithList level2 =
            NestedImmutableLevel2RecordWithList.builder()
                                               .attr(ATTR_LEVEL2)
                                               .level3(level3)
                                               .level3List(new ArrayList<>(singletonList(level3)))
                                               .build();

        return NestedImmutableRecordWithList.builder()
                                            .id(ID_1)
                                            .attr(ATTR_LEVEL1).level2(level2)
                                            .level2List(new ArrayList<>(singletonList(level2)))
                                            .build();
    }

    public static SimpleBeanRecordWithMap buildSimpleBeanRecordWithMap() {
        return new SimpleBeanRecordWithMap()
            .setId(ID_1)
            .setAttr(ATTR_LEVEL1)
            .setChildMap(ImmutableMap.of(
                CHILD1_KEY, new SimpleBeanChild().setId(ID_1).setAttr(ATTR_CHILD1),
                CHILD2_KEY, new SimpleBeanChild().setId(ID_2).setAttr(ATTR_CHILD2)
            ));
    }

    public static NestedBeanRecordWithMap buildNestedBeanRecordWithMap() {
        NestedBeanLevel4Record level4 =
            new NestedBeanLevel4Record()
                .setId(ID_1)
                .setAttr(ATTR_LEVEL4);

        NestedBeanLevel3RecordWithMap level3 =
            new NestedBeanLevel3RecordWithMap()
                .setAttr(ATTR_LEVEL3)
                .setLevel4(level4)
                .setLevel4Map(ImmutableMap.of(LEVEL4_KEY, level4));

        NestedBeanLevel2RecordWithMap level2 =
            new NestedBeanLevel2RecordWithMap()
                .setAttr(ATTR_LEVEL2)
                .setLevel3(level3)
                .setLevel3Map(ImmutableMap.of(LEVEL3_KEY, level3));

        return new NestedBeanRecordWithMap()
            .setId(ID_1)
            .setAttr(ATTR_LEVEL1)
            .setLevel2(level2)
            .setLevel2Map(ImmutableMap.of(LEVEL2_KEY, level2));
    }

    public static SimpleImmutableRecordWithMap buildSimpleImmutableRecordWithMap() {
        return SimpleImmutableRecordWithMap.builder()
                                           .id(ID_1).attr(ATTR_LEVEL1)
                                           .childMap(ImmutableMap.of(
                                               CHILD1_KEY, SimpleImmutableChild.builder().id(ID_1).attr(ATTR_CHILD1).build(),
                                               CHILD2_KEY, SimpleImmutableChild.builder().id(ID_2).attr(ATTR_CHILD2).build()))
                                           .build();
    }

    public static NestedImmutableRecordWithMap buildNestedImmutableRecordWithMap() {
        NestedImmutableLevel4Record level4 =
            NestedImmutableLevel4Record.builder()
                                       .id(ID_1)
                                       .attr(ATTR_LEVEL4)
                                       .build();

        NestedImmutableLevel3RecordWithMap level3 =
            NestedImmutableLevel3RecordWithMap.builder()
                                              .attr(ATTR_LEVEL3)
                                              .level4(level4)
                                              .level4Map(new HashMap<>(singletonMap(LEVEL4_KEY, level4)))
                                              .build();

        NestedImmutableLevel2RecordWithMap level2 =
            NestedImmutableLevel2RecordWithMap.builder()
                                              .attr(ATTR_LEVEL2)
                                              .level3(level3)
                                              .level3Map(new HashMap<>(singletonMap(LEVEL3_KEY, level3)))
                                              .build();

        return NestedImmutableRecordWithMap.builder()
                                           .id(ID_1)
                                           .attr(ATTR_LEVEL1)
                                           .level2(level2)
                                           .level2Map(new HashMap<>(singletonMap(LEVEL2_KEY, level2)))
                                           .build();
    }
}