/*
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License").
 * You may not use this file except in compliance with the License.
 * A copy of the License is located at
 *
 *  http://aws.amazon.com/apache2.0
 *
 * or in the "license" file accompanying this file. This file is distributed
 * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

package software.amazon.awssdk.enhanced.dynamodb.functionaltests.models;

import static software.amazon.awssdk.enhanced.dynamodb.extensions.AutoGeneratedTimestampRecordExtension.AttributeTags.autoGeneratedTimestampAttribute;
import static software.amazon.awssdk.enhanced.dynamodb.mapper.StaticAttributeTags.primaryPartitionKey;

import java.time.Instant;
import java.util.Collections;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.Set;
import software.amazon.awssdk.enhanced.dynamodb.EnhancedType;
import software.amazon.awssdk.enhanced.dynamodb.TableSchema;
import software.amazon.awssdk.enhanced.dynamodb.extensions.annotations.DynamoDbAutoGeneratedTimestampAttribute;
import software.amazon.awssdk.enhanced.dynamodb.mapper.StaticImmutableTableSchema;
import software.amazon.awssdk.enhanced.dynamodb.mapper.StaticTableSchema;
import software.amazon.awssdk.enhanced.dynamodb.mapper.annotations.DynamoDbBean;
import software.amazon.awssdk.enhanced.dynamodb.mapper.annotations.DynamoDbImmutable;
import software.amazon.awssdk.enhanced.dynamodb.mapper.annotations.DynamoDbPartitionKey;

/**
 * Test models specifically designed for auto-generated timestamp functionality testing. These models focus on the "time"
 * attribute with @DynamoDbAutoGeneratedTimestampAttribute annotation and are used by AutoGeneratedTimestampExtensionTest.
 */
public final class AutogeneratedTimestampTestModels {

    private AutogeneratedTimestampTestModels() {
    }

    @DynamoDbBean
    public static class SimpleBeanWithList {
        private String id;
        private Instant time;
        private List<SimpleBeanChild> childList;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public SimpleBeanWithList setId(String id) {
            this.id = id;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public SimpleBeanWithList setTime(Instant time) {
            this.time = time;
            return this;
        }

        public List<SimpleBeanChild> getChildList() {
            return childList == null ? null : Collections.unmodifiableList(childList);
        }

        public SimpleBeanWithList setChildList(List<SimpleBeanChild> childList) {
            this.childList = childList;
            return this;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) {
                return true;
            }
            if (o == null || getClass() != o.getClass()) {
                return false;
            }
            SimpleBeanWithList that = (SimpleBeanWithList) o;
            return Objects.equals(id, that.id) &&
                   Objects.equals(time, that.time) && Objects.equals(childList, that.childList);
        }

        @Override
        public int hashCode() {
            return Objects.hash(id, time, childList);
        }
    }

    @DynamoDbBean
    public static class SimpleBeanWithSet {
        private String id;
        private Instant time;
        private Set<String> childSet;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public SimpleBeanWithSet setId(String id) {
            this.id = id;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public SimpleBeanWithSet setTime(Instant time) {
            this.time = time;
            return this;
        }

        public Set<String> getChildSet() {
            return childSet == null ? null : Collections.unmodifiableSet(childSet);
        }

        public SimpleBeanWithSet setChildSet(Set<String> childSet) {
            this.childSet = childSet;
            return this;
        }
    }

    @DynamoDbBean
    public static class SimpleBeanWithMap {
        private String id;
        private Instant time;
        private Map<String, String> childMap;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public SimpleBeanWithMap setId(String id) {
            this.id = id;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public SimpleBeanWithMap setTime(Instant time) {
            this.time = time;
            return this;
        }

        public Map<String, String> getChildMap() {
            return childMap == null ? null : Collections.unmodifiableMap(childMap);
        }

        public SimpleBeanWithMap setChildMap(Map<String, String> childMap) {
            this.childMap = childMap;
            return this;
        }
    }

    @DynamoDbBean
    public static class SimpleBeanChild {
        private String id;
        private Instant time;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public SimpleBeanChild setId(String id) {
            this.id = id;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public SimpleBeanChild setTime(Instant time) {
            this.time = time;
            return this;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) {
                return true;
            }
            if (o == null || getClass() != o.getClass()) {
                return false;
            }
            SimpleBeanChild that = (SimpleBeanChild) o;
            return Objects.equals(id, that.id) && Objects.equals(time, that.time);
        }

        @Override
        public int hashCode() {
            return Objects.hash(id, time);
        }
    }

    @DynamoDbBean
    public static class NestedBeanWithList {
        private String id;
        private Instant time;
        private NestedBeanChild level2;

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        public NestedBeanWithList setId(String id) {
            this.id = id;
            return this;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanWithList setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedBeanChild getLevel2() {
            return level2;
        }

        public NestedBeanWithList setLevel2(NestedBeanChild level2) {
            this.level2 = level2;
            return this;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) {
                return true;
            }
            if (o == null || getClass() != o.getClass()) {
                return false;
            }
            NestedBeanWithList that = (NestedBeanWithList) o;
            return Objects.equals(id, that.id) &&
                   Objects.equals(time, that.time) && Objects.equals(level2, that.level2);
        }

        @Override
        public int hashCode() {
            return Objects.hash(id, time, level2);
        }
    }

    @DynamoDbBean
    public static class NestedBeanChild {
        private Instant time;

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedBeanChild setTime(Instant time) {
            this.time = time;
            return this;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) {
                return true;
            }
            if (o == null || getClass() != o.getClass()) {
                return false;
            }
            NestedBeanChild that = (NestedBeanChild) o;
            return Objects.equals(time, that.time);
        }

        @Override
        public int hashCode() {
            return Objects.hash(time);
        }
    }

    @DynamoDbImmutable(builder = SimpleImmutableRecordWithList.Builder.class)
    public static final class SimpleImmutableRecordWithList {
        private final String id;
        private final Instant time;
        private final List<SimpleImmutableChild> childList;

        private SimpleImmutableRecordWithList(Builder b) {
            this.id = b.id;
            this.time = b.time;
            this.childList = b.childList;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public List<SimpleImmutableChild> getChildList() {
            return childList == null ? null : Collections.unmodifiableList(childList);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private Instant time;
            private List<SimpleImmutableChild> childList;

            public Builder id(String id) {
                this.id = id;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public Builder childList(List<SimpleImmutableChild> childList) {
                this.childList = childList;
                return this;
            }

            public SimpleImmutableRecordWithList build() {
                return new SimpleImmutableRecordWithList(this);
            }
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) {
                return true;
            }
            if (o == null || getClass() != o.getClass()) {
                return false;
            }
            SimpleImmutableRecordWithList that = (SimpleImmutableRecordWithList) o;
            return Objects.equals(id, that.id) &&
                   Objects.equals(time, that.time) && Objects.equals(childList, that.childList);
        }

        @Override
        public int hashCode() {
            return Objects.hash(id, time, childList);
        }
    }

    @DynamoDbImmutable(builder = SimpleImmutableChild.Builder.class)
    public static final class SimpleImmutableChild {
        private final String id;
        private final Instant time;

        private SimpleImmutableChild(Builder b) {
            this.id = b.id;
            this.time = b.time;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private Instant time;

            public Builder id(String id) {
                this.id = id;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public SimpleImmutableChild build() {
                return new SimpleImmutableChild(this);
            }
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) {
                return true;
            }
            if (o == null || getClass() != o.getClass()) {
                return false;
            }
            SimpleImmutableChild that = (SimpleImmutableChild) o;
            return Objects.equals(id, that.id) && Objects.equals(time, that.time);
        }

        @Override
        public int hashCode() {
            return Objects.hash(id, time);
        }
    }

    @DynamoDbImmutable(builder = SimpleImmutableRecordWithSet.Builder.class)
    public static final class SimpleImmutableRecordWithSet {
        private final String id;
        private final Instant time;
        private final Set<String> childSet;

        private SimpleImmutableRecordWithSet(Builder b) {
            this.id = b.id;
            this.time = b.time;
            this.childSet = b.childSet;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public Set<String> getChildSet() {
            return childSet == null ? null : Collections.unmodifiableSet(childSet);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private Instant time;
            private Set<String> childSet;

            public Builder id(String id) {
                this.id = id;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public Builder childSet(Set<String> childSet) {
                this.childSet = childSet;
                return this;
            }

            public SimpleImmutableRecordWithSet build() {
                return new SimpleImmutableRecordWithSet(this);
            }
        }
    }

    @DynamoDbImmutable(builder = SimpleImmutableRecordWithMap.Builder.class)
    public static final class SimpleImmutableRecordWithMap {
        private final String id;
        private final Instant time;
        private final Map<String, String> childMap;

        private SimpleImmutableRecordWithMap(Builder b) {
            this.id = b.id;
            this.time = b.time;
            this.childMap = b.childMap;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public Map<String, String> getChildMap() {
            return childMap == null ? null : Collections.unmodifiableMap(childMap);
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private Instant time;
            private Map<String, String> childMap;

            public Builder id(String id) {
                this.id = id;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public Builder childMap(Map<String, String> childMap) {
                this.childMap = childMap;
                return this;
            }

            public SimpleImmutableRecordWithMap build() {
                return new SimpleImmutableRecordWithMap(this);
            }
        }
    }

    @DynamoDbImmutable(builder = NestedImmutableRecordWithList.Builder.class)
    public static final class NestedImmutableRecordWithList {
        private final String id;
        private final Instant time;
        private final NestedImmutableChildRecordWithList level2;

        private NestedImmutableRecordWithList(Builder b) {
            this.id = b.id;
            this.time = b.time;
            this.level2 = b.level2;
        }

        @DynamoDbPartitionKey
        public String getId() {
            return id;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public NestedImmutableChildRecordWithList getLevel2() {
            return level2;
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private String id;
            private Instant time;
            private NestedImmutableChildRecordWithList level2;

            public Builder id(String id) {
                this.id = id;
                return this;
            }

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public Builder level2(NestedImmutableChildRecordWithList level2) {
                this.level2 = level2;
                return this;
            }

            public NestedImmutableRecordWithList build() {
                return new NestedImmutableRecordWithList(this);
            }
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) {
                return true;
            }
            if (o == null || getClass() != o.getClass()) {
                return false;
            }
            NestedImmutableRecordWithList that = (NestedImmutableRecordWithList) o;
            return Objects.equals(id, that.id) &&
                   Objects.equals(time, that.time) && Objects.equals(level2, that.level2);
        }

        @Override
        public int hashCode() {
            return Objects.hash(id, time, level2);
        }
    }

    @DynamoDbImmutable(builder = NestedImmutableChildRecordWithList.Builder.class)
    public static final class NestedImmutableChildRecordWithList {
        private final Instant time;

        private NestedImmutableChildRecordWithList(Builder b) {
            this.time = b.time;
        }

        @DynamoDbAutoGeneratedTimestampAttribute
        public Instant getTime() {
            return time;
        }

        public static Builder builder() {
            return new Builder();
        }

        public static final class Builder {
            private Instant time;

            public Builder time(Instant time) {
                this.time = time;
                return this;
            }

            public NestedImmutableChildRecordWithList build() {
                return new NestedImmutableChildRecordWithList(this);
            }
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) {
                return true;
            }
            if (o == null || getClass() != o.getClass()) {
                return false;
            }
            NestedImmutableChildRecordWithList that = (NestedImmutableChildRecordWithList) o;
            return Objects.equals(time, that.time);
        }

        @Override
        public int hashCode() {
            return Objects.hash(time);
        }
    }

    public static class SimpleStaticRecordWithList {
        private String id;
        private Instant time;

        public String getId() {
            return id;
        }

        public SimpleStaticRecordWithList setId(String id) {
            this.id = id;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public SimpleStaticRecordWithList setTime(Instant time) {
            this.time = time;
            return this;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) {
                return true;
            }
            if (o == null || getClass() != o.getClass()) {
                return false;
            }
            SimpleStaticRecordWithList that = (SimpleStaticRecordWithList) o;
            return Objects.equals(id, that.id) && Objects.equals(time, that.time);
        }

        @Override
        public int hashCode() {
            return Objects.hash(id, time);
        }
    }

    public static class NestedStaticRecordWithList {
        private String id;
        private Instant time;
        private NestedStaticChildRecordWithList level2;

        public String getId() {
            return id;
        }

        public NestedStaticRecordWithList setId(String id) {
            this.id = id;
            return this;
        }

        public Instant getTime() {
            return time;
        }

        public NestedStaticRecordWithList setTime(Instant time) {
            this.time = time;
            return this;
        }

        public NestedStaticChildRecordWithList getLevel2() {
            return level2;
        }

        public NestedStaticRecordWithList setLevel2(NestedStaticChildRecordWithList level2) {
            this.level2 = level2;
            return this;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) {
                return true;
            }
            if (o == null || getClass() != o.getClass()) {
                return false;
            }
            NestedStaticRecordWithList that = (NestedStaticRecordWithList) o;
            return Objects.equals(id, that.id) &&
                   Objects.equals(time, that.time) && Objects.equals(level2, that.level2);
        }

        @Override
        public int hashCode() {
            return Objects.hash(id, time, level2);
        }
    }

    public static class NestedStaticChildRecordWithList {
        private Instant time;

        public Instant getTime() {
            return time;
        }

        public NestedStaticChildRecordWithList setTime(Instant time) {
            this.time = time;
            return this;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) {
                return true;
            }
            if (o == null || getClass() != o.getClass()) {
                return false;
            }
            NestedStaticChildRecordWithList that = (NestedStaticChildRecordWithList) o;
            return Objects.equals(time, that.time);
        }

        @Override
        public int hashCode() {
            return Objects.hash(time);
        }
    }

    public static TableSchema<SimpleStaticRecordWithList> buildStaticSchemaForSimpleRecordWithList() {
        return StaticTableSchema.builder(SimpleStaticRecordWithList.class)
                                .newItemSupplier(SimpleStaticRecordWithList::new)
                                .addAttribute(String.class, a -> a.name("id")
                                                                  .getter(SimpleStaticRecordWithList::getId)
                                                                  .setter(SimpleStaticRecordWithList::setId)
                                                                  .tags(primaryPartitionKey()))
                                .addAttribute(Instant.class, a -> a.name("time")
                                                                   .getter(SimpleStaticRecordWithList::getTime)
                                                                   .setter(SimpleStaticRecordWithList::setTime)
                                                                   .tags(autoGeneratedTimestampAttribute()))
                                .build();
    }

    public static TableSchema<NestedStaticRecordWithList> buildStaticSchemaForNestedRecordWithList() {
        TableSchema<NestedStaticChildRecordWithList> level2Schema =
            StaticTableSchema.builder(NestedStaticChildRecordWithList.class)
                             .newItemSupplier(NestedStaticChildRecordWithList::new)
                             .addAttribute(Instant.class, a -> a.name("time")
                                                                .getter(NestedStaticChildRecordWithList::getTime)
                                                                .setter(NestedStaticChildRecordWithList::setTime)
                                                                .tags(autoGeneratedTimestampAttribute()))
                             .build();

        return StaticTableSchema.builder(NestedStaticRecordWithList.class)
                                .newItemSupplier(NestedStaticRecordWithList::new)
                                .addAttribute(String.class, a -> a.name("id")
                                                                  .getter(NestedStaticRecordWithList::getId)
                                                                  .setter(NestedStaticRecordWithList::setId)
                                                                  .tags(primaryPartitionKey()))
                                .addAttribute(Instant.class, a -> a.name("time")
                                                                   .getter(NestedStaticRecordWithList::getTime)
                                                                   .setter(NestedStaticRecordWithList::setTime)
                                                                   .tags(autoGeneratedTimestampAttribute()))
                                .addAttribute(EnhancedType.documentOf(NestedStaticChildRecordWithList.class, level2Schema),
                                              a -> a.name("level2")
                                                    .getter(NestedStaticRecordWithList::getLevel2)
                                                    .setter(NestedStaticRecordWithList::setLevel2))
                                .build();
    }

    public static TableSchema<SimpleImmutableRecordWithList> buildStaticImmutableSchemaForSimpleRecordWithList() {
        TableSchema<SimpleImmutableChild> childSchema =
            StaticImmutableTableSchema.builder(SimpleImmutableChild.class,
                                               SimpleImmutableChild.Builder.class)
                                      .newItemBuilder(SimpleImmutableChild::builder,
                                                      SimpleImmutableChild.Builder::build)
                                      .addAttribute(String.class, a -> a.name("id")
                                                                        .getter(SimpleImmutableChild::getId)
                                                                        .setter(SimpleImmutableChild.Builder::id)
                                                                        .tags(primaryPartitionKey()))
                                      .addAttribute(Instant.class, a -> a.name("time")
                                                                         .getter(SimpleImmutableChild::getTime)
                                                                         .setter(SimpleImmutableChild.Builder::time)
                                                                         .tags(autoGeneratedTimestampAttribute()))
                                      .build();

        return StaticImmutableTableSchema.builder(SimpleImmutableRecordWithList.class,
                                                  SimpleImmutableRecordWithList.Builder.class)
                                         .newItemBuilder(SimpleImmutableRecordWithList::builder,
                                                         SimpleImmutableRecordWithList.Builder::build)
                                         .addAttribute(String.class, a -> a.name("id")
                                                                           .getter(SimpleImmutableRecordWithList::getId)
                                                                           .setter(SimpleImmutableRecordWithList.Builder::id)
                                                                           .tags(primaryPartitionKey()))
                                         .addAttribute(Instant.class, a -> a.name("time")
                                                                            .getter(SimpleImmutableRecordWithList::getTime)
                                                                            .setter(SimpleImmutableRecordWithList.Builder::time)
                                                                            .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.listOf(EnhancedType.documentOf(SimpleImmutableChild.class,
                                                                                                   childSchema)),
                                                       a -> a.name("childList")
                                                             .getter(SimpleImmutableRecordWithList::getChildList)
                                                             .setter(SimpleImmutableRecordWithList.Builder::childList))
                                         .build();
    }

    public static TableSchema<NestedImmutableRecordWithList> buildStaticImmutableSchemaForNestedRecordWithList() {
        TableSchema<NestedImmutableChildRecordWithList> level2Schema =
            StaticImmutableTableSchema.builder(NestedImmutableChildRecordWithList.class,
                                               NestedImmutableChildRecordWithList.Builder.class)
                                      .newItemBuilder(NestedImmutableChildRecordWithList::builder,
                                                      NestedImmutableChildRecordWithList.Builder::build)
                                      .addAttribute(Instant.class, a -> a.name("time")
                                                                         .getter(NestedImmutableChildRecordWithList::getTime)
                                                                         .setter(NestedImmutableChildRecordWithList.Builder::time)
                                                                         .tags(autoGeneratedTimestampAttribute()))
                                      .build();

        return StaticImmutableTableSchema.builder(NestedImmutableRecordWithList.class,
                                                  NestedImmutableRecordWithList.Builder.class)
                                         .newItemBuilder(NestedImmutableRecordWithList::builder,
                                                         NestedImmutableRecordWithList.Builder::build)
                                         .addAttribute(String.class, a -> a.name("id")
                                                                           .getter(NestedImmutableRecordWithList::getId)
                                                                           .setter(NestedImmutableRecordWithList.Builder::id)
                                                                           .tags(primaryPartitionKey()))
                                         .addAttribute(Instant.class, a -> a.name("time")
                                                                            .getter(NestedImmutableRecordWithList::getTime)
                                                                            .setter(NestedImmutableRecordWithList.Builder::time)
                                                                            .tags(autoGeneratedTimestampAttribute()))
                                         .addAttribute(EnhancedType.documentOf(NestedImmutableChildRecordWithList.class,
                                                                               level2Schema),
                                                       a -> a.name("level2")
                                                             .getter(NestedImmutableRecordWithList::getLevel2)
                                                             .setter(NestedImmutableRecordWithList.Builder::level2))
                                         .build();
    }
}